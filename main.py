import os
from flask import Flask, request
import telebot
from telebot import types
import requests
import json
import base64 # تم إضافة هذه المكتبة لتحويل الصور إلى Base64

# --- إعدادات البوت والـ API ---

# يتم جلب التوكن من متغيرات البيئة.
# تأكد من أن متغير البيئة TELEGRAM_TOKEN مضبوط بشكل صحيح في إعدادات Render.
TOKEN = os.getenv("TELEGRAM_TOKEN")
if not TOKEN:
    raise ValueError("⚠️ متغير البيئة TELEGRAM_TOKEN غير موجود. الرجاء إضافته في إعدادات Render.")

# تهيئة كائن البوت باستخدام التوكن
bot = telebot.TeleBot(TOKEN)
# تهيئة تطبيق Flask
app = Flask(__name__)

# عنوان URL لخدمة Render الخاصة بك.
# RENDER_EXTERNAL_URL هو متغير بيئة يتم توفيره بواسطة Render ويحتوي على URL الأساسي لتطبيقك.
RENDER_EXTERNAL_URL_BASE = os.getenv("RENDER_EXTERNAL_URL")
if RENDER_EXTERNAL_URL_BASE:
    # تأكد من أن URL ينتهي بشرطة مائلة
    if not RENDER_EXTERNAL_URL_BASE.endswith('/'):
        RENDER_EXTERNAL_URL_BASE += '/'
    RENDER_WEBHOOK_URL = RENDER_EXTERNAL_URL_BASE + TOKEN
else:
    # يجب استبدال هذا بـ URL الخاص بتطبيقك المنشور إذا كنت لا تستخدم Render أو لم يتم تعيين المتغير.
    # مثال: "https://your-app-name.onrender.com/" + TOKEN
    RENDER_WEBHOOK_URL = "https://your-deployed-app-url.com/" + TOKEN
    print("⚠️ لم يتم العثور على متغير بيئة RENDER_EXTERNAL_URL. يرجى تحديث RENDER_WEBHOOK_URL يدوياً.")

# إعدادات واجهة برمجة تطبيقات Gemini (نموذج gemini-2.0-flash).
# تم تضمين مفتاح API مباشرة في الكود بناءً على طلب المستخدم.
# تحذير: هذه الممارسة لا يُنصح بها لأسباب أمنية في بيئات الإنتاج.
GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent"
GEMINI_API_KEY = "AIzaSyAMTPehz-r1y1V2TKyNeItcjkFDxFvwJ1c" # تم التعديل: المفتاح مضاف مباشرة

# -- قائمة الأوامر على اليسار (أزرار في لوحة المفاتيح) --
left_commands = ["star", "help"]

# --- قائمة يمين البوت: التبويبات الرئيسية (أزرار في لوحة المفاتيح) ---
# تم تعديل الترتيب وإضافة التبويبات الجديدة كما طُلب.
right_tabs = [
    "تقويم عام 1447ه‍.",
    "خدمات التواصل مع الجامعة",
    "الاسئلة الشائعة_عام",
    "تخصصات برامج الدبلوم - حضوري",
    "تخصصات برامج الدبلوم - عن بُعد",
    "قروبات التخصص", # تبويب جديد - الترتيب السادس
    "قروبات المواد للمستجدين", # تبويب جديد - الترتيب السابع
    "كتب وملخصات مواد الدبلوم", # تبويب جديد - الترتيب الثامن
    "قناة وإعلانات الدبلوم 📢",
    "خدمات حل الواجبات وعمل المشاريع والبحوث",
    "مواقع فروع جامعة الملك سعود",
    "شروط التجسير في جامعة الملك سعود",
    "🛑شرح استخدام – البلاك بورد / Blackboard 🛑",
    "🤖 اسأل الذكاء الاصطناعي" # الزر الجديد للدردشة مع الذكاء الاصطناعي
]

# قاموس لتخزين حالة القائمة الحالية لكل مستخدم
# هذا يسمح للبوت بتذكر أين كان المستخدم في القوائم المتداخلة
user_states = {} # {chat_id: current_menu_key}

# --- وظيفة للحصول على استجابة من Gemini API (متعدد الوسائط) ---
def get_gemini_multimodal_response(parts):
    """
    يرسل مطالبة متعددة الوسائط (نص وصور) إلى Gemini API ويعيد النص الذي تم إنشاؤه.
    """
    if not GEMINI_API_KEY:
        return "عذراً، لا يمكنني التواصل مع الذكاء الاصطناعي حالياً. مفتاح الـ API غير متوفر."

    payload = {
        "contents": [
            {
                "role": "user",
                "parts": parts # هنا نمرر قائمة الأجزاء (النص والصورة)
            }
        ]
    }
    headers = {'Content-Type': 'application/json'}
    params = {'key': GEMINI_API_KEY}

    response = requests.post(GEMINI_API_URL, headers=headers, params=params, data=json.dumps(payload))
    response.raise_for_status() # إطلاق استثناء لأي أخطاء HTTP (مثل 4xx أو 5xx)
    result = response.json()

    if result.get("candidates") and result["candidates"][0].get("content") and result["candidates"][0]["content"].get("parts"):
        return result["candidates"][0]["content"]["parts"][0]["text"]
    else:
        print(f"ERROR: Unexpected Gemini API response structure: {result}")
        return "عذراً، لم أتمكن من الحصول على إجابة واضحة من الذكاء الاصطناعي."

# قاموس شامل لتخزين جميع محتويات البوت، بما في ذلك النصوص والقوائم الفرعية
# تم تحويل جميع النصوص الطويلة إلى تنسيق HTML متوافق مع تليجرام
bot_content = {
    "تقويم عام 1447ه‍.": "التقويم الدراسي للعام الجامعي 1447هـ في جامعة الملك سعود لم يُنشر بشكل رسمي بعد",
    "خدمات التواصل مع الجامعة": """عمادة السنة الأولى المشتركة
SSHELP@CFY.KSU.EDU.SA
00966-114694006

الشؤون الطلابية
ksugcc@ksu.edu.sa
00966 1 8050141

المشرف على وحدة التوجيه و الإرشاد الطلابي
sg@cfy.ksu.edu.sa
4694118
رقم المكتب: 2484

المشرف على وحدة شؤون الطلاب
sa@cfy.ksu.edu.sa

ايميلات عمادة القبول والتسجيل
dar@ksu.edu.sa
darweb@ksu.edu.sa

ارقام عمادة القبول والتسجيل
0114677722
0118054402

منسق/ة الفيزياء
nbennessib@ksu.edu.sa
nalkathran@ksu.edu.sa

منسق احياء
aalii@ksu.edu.sa
somer@ksu.edu.sa

منسق كيم
amenizi@ksu.edu.sa
zalmarhoon@ksu.edu.sa

منسق/ة انجل
mramadan@cfy.ksu.edu.sa
h.alshareef@cfy.ksu.edu.sa

فرع عليشه ( بنات)
011 805 7331

فرع الناصريه( الوشم بمسمى اخر)
0114036600""",
    "الاسئلة الشائعة_عام": """<b>● الأسئلة الشائعة - عام</b>
◇ الأسئلة الشائعة حول القبول: <a href="https://dar.ksu.edu.sa/ar/FAQ">اضغط هنا</a>
◇ الأسئلة الشائعة للطلاب المنتظمين: <a href="https://dar.ksu.edu.sa/ar/faqs">اضغط هنا</a>
◇ الأسئلة الشائعة للطلاب الخريجين: <a href="https://dar.ksu.edu.sa/ar/gfaq">اضغط هنا</a>""",
    "تخصصات برامج الدبلوم - حضوري": {
        "menu_text": "الرجاء اختيار تخصص الدبلوم الحضوري:",
        "options": [
            "دبلوم محاسبة",
            "دبلوم التسويق",
            "دبلوم الأنظمة",
            "دبلوم البرمجة وقواعد البيانات",
            "دبلوم السكرتارية الطبية",
            "دبلوم الاعمال المصرفية",
            "دبلوم الوسائط المتعددة التفاعلية",
            "دبلوم الامن السيبراني",
            "دبلوم السكرتارية التنفيذية",
            "دبلوم تقنية النظارات",
            "دبلوم إدارة الموارد البشرية",
            "دبلوم المحاسبة الضريبية",
            "دبلوم الترجمة بلغة الإشارة",
            "دبلوم مقدمي الرعاية بالحضانات",
            "دبلوم اللغة الصينية",
            "الدبلوم المشارك في العمل الخيري",
            "🔙 رجوع"
        ],
        "دبلوم محاسبة": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في المحاسبة – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تلبية متطلبات سوق العمل السعودي من الكوادر المؤهلة في المحاسبة، من خلال إعداد خريجين يمتلكون المعارف والمهارات اللازمة لأداء المهام المحاسبية بكفاءة.
\n<b>🎯 الأهداف الرئيسة:</b>
• توفير بيئة أكاديمية متطورة لإعداد كوادر متميزة.
• تأهيل الطلبة بأحدث المفاهيم والمعارف النظرية والتطبيقية.
• تنمية المهارات الفكرية والبحثية للعمل بكفاءة عالية.
• تطوير المهارات العملية لإنجاز الأنشطة المحاسبية.
• تدريب الطلاب على استخدام الحاسب الآلي والتطبيقات المحاسبية الحديثة.
• تقديم مرجعية علمية تجمع بين الجانب النظري والتطبيقي.
\n\n<b>💼 الفرص الوظيفية:</b>
• مساعد محاسب، محصل إيرادات، مأمور مبيعات، أمين صندوق، مأمور عهد، مراقب عهد، مراقب مخازن، أمين مستودع، مفتش تموين، مأمور مشتريات، مراقب تجاري، مساعد مدقق حسابات، كاتب إداري في الإدارة المالية، مساعد مدرب في مجال التخصص.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في المحاسبة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في المحاسبة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_lmqrrt_ldblwm_lmhsb.pdf\">عرض الوصف</a>"
        },
        "دبلوم التسويق": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في التسويق – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر مهنية متمكنة للعمل بكفاءة عالية في الوظائف المتخصصة في قطاعات الأعمال بالمملكة، بتزويدهم بالمعارف والمهارات العملية التسويقية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل الطلاب نظريًا وعمليًا في التسويق الحديث.
• تدريب الطلاب على التطبيقات العملية.
• تمكين الطلاب من استخدام تقنيات المعلومات في اتخاذ القرارات التسويقية.
• تنمية قدرة الطلاب على التعامل مع المشكلات التسويقية.
• إعداد الطلاب للتفاعل الفعال مع التحديات المستقبلية.
\n\n<b>📘 المخرجات المعرفية:</b>
• فهم عميق للمفاهيم والمبادئ والتقنيات التسويقية.
• التعرّف على القضايا والاتجاهات الحالية في بيئة التسويق.
• فهم أدوات وتقنيات التسويق من منظور داخلي وخارجي.
• التمكن من استخدام التكنولوجيات الحديثة في التعامل مع العملاء.
• الإلمام بالأساليب والمنهجيات المستخدمة في البحوث التسويقية.
\n\n<b>🛠 المخرجات المهارية:</b>
• القدرة على العمل ضمن فرق أو بشكل فردي.
• إدراك الجوانب الأخلاقية المتعلقة بمهنة التسويق.
• التواصل الفعال كتابيًا وشفويًا باستخدام الوسائل الرقمية.
• توظيف المهارات العددية والتحليلية في حل المشكلات.
\n\n<b>💼 الفرص الوظيفية:</b>
• مأمور مبيعات، مساعد مدرب (في مجال التخصص)، مدقق مشتريات مساعد، محصل إيرادات، مأمور مشتريات، مراقب تجاري، كاتب في إدارة التسويق.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في التسويق (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D8%AA%D8%B3%D9%88%D9%8A%D9%82_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في التسوق: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/imce_images/2_4.pdf\">عرض الوصف</a>"
        },
        "دبلوم الأنظمة": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الأنظمة – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر قانونية مؤهلة للعمل بكفاءة في القطاعات الإدارية والاستثمارية، والمساهمة في تطوير المنظومة القانونية بما يتوافق مع رؤية 2030.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل كفاءات قانونية قادرة على المنافسة في سوق العمل.
• دعم تطوير وتفعيل الأنظمة القانونية الحديثة.
• تعزيز الثقافة القانونية ونشر الوعي.
• تطوير التدريب الميداني للطلاب.
• توظيف الخبرات لتطوير البحث العلمي وجودة التعليم.
\n\n<b>💼 الفرص الوظيفية:</b>
<b>أولاً – في القطاع التجاري والاستثماري:</b>
• مراقب تجاري، مراقب جمركي، مدقق جمركي، مدقق طلبات، مراجع قانوني.
<b>ثانيًا – في القطاع الإداري والعدلي:</b>
• مساعد إداري، مساعد محامٍ، كاتب عدل، كاتب ضبط، مدقق قانوني، مدخل بيانات قانونية.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الأنظمة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في الأنظمة: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/imce_images/2_2.pdf\">عرض الوصف</a>"
        },
        "دبلوم البرمجة وقواعد البيانات": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في برمجة وقواعد البيانات – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر فنية متخصصة ومؤهلة في مجالي البرمجة وقواعد البيانات، لتلبية احتياجات سوق العمل من خلال التدريب العملي والمعرفة التقنية الحديثة.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تخريج فنيين متخصصين في تصميم نظم البرمجة وقواعد البيانات.
• تدريب الطلاب على أحدث أساليب وتقنيات البرمجة.
• تعريف الطلاب بمفاهيم تحليل وتصميم النظم.
• إكساب الدارسين مهارات تصميم وصيانة قواعد البيانات.
• تأهيل الطلاب لفهم نظم التشغيل الحديثة.
\n\n<b>💼 الفرص الوظيفية:</b>
• مساعد مبرمج، مشغّل أجهزة حاسب آلي، فني مواصفات ومقاييس، مساعد مدرب (في مجال التخصص).
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في البرمجة وقواعد البيانات (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في البرمجة وقواعد البيانات: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/twsyf_lmqrrt_lbrnmj_ldblwm_fy_lbrmj_wqwd_lbynt.pdf\">عرض الوصف</a>"
        },
        "دبلوم السكرتارية الطبية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في السكرتارية الطبية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تأهيل كوادر وطنية متخصصة في السكرتارية الطبية، للعمل بكفاءة واحترافية في المنشآت الصحية وتلبية احتياجات سوق العمل.
\n<b>🎯 الأهداف الرئيسة:</b>
• إعداد كوادر مؤهلة للعمل في السكرتارية الطبية.
• إكساب الطلاب المهارات الإدارية والفنية الأساسية.
• تنمية السلوكيات المهنية ومهارات التواصل.
• الإلمام بالنظام الصحي السعودي وكيفية التعامل مع التأمين.
• تدريب الطلاب على المهام المكتبية باستخدام التقنيات الحديثة.
• تعزيز مهارات اللغة الإنجليزية الطبية.
\n\n<b>💼 الفرص الوظيفية:</b>
• مصنّف من <b>وزارة الخدمة المدنية</b> ومعتمد من <b>هيئة التخصصات الصحية</b>.
• التعيين على <b>كادر الوظائف الصحية – المرتبة السادسة</b>.
• سكرتير طبي في المستشفيات (الحكومية والخاصة).
• فني سجلات طبية في القطاعات الصحية.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في السكرتارية الطبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في السكرتارية الطبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_dblwm_lskrtry_ltby.pdf\">عرض الوصف</a>"
        },
        "دبلوم الاعمال المصرفية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🎓 <b>الدبلوم المتوسط في الإدارة المالية والمصرفية – جامعة الملك سعود</b>
يهدف البرنامج إلى إعداد كوادر مؤهلة في المالية والمصرفية، قادرة على مواكبة التغيرات الاقتصادية وتلبية احتياجات سوق العمل.
\n\n<b>🎯 الأهداف:</b>
1.  إكساب المعرفة بالمفاهيم والمبادئ والأنظمة المالية والمصرفية.
2.  تأهيل الطلاب للتطورات الحديثة في القطاع.
3.  إعداد الخريجين لوظائف متنوعة في المؤسسات المالية والبنكية.
4.  تنمية مهاراتهم التحليلية، التواصلية، والرقمية.
\n\n<b>📘 المخرجات:</b>
•   فهم الأدوات المالية، التحليل المالي، أنواع المؤسسات والأسواق المالية، وأساسيات الإدارة المالية والاستثمار.
•   القدرة على تحليل البيانات المالية، التنبؤ بالمخاطر، وحل القضايا المالية.
•   الالتزام بالأخلاقيات المهنية والعمل الجماعي.
•   إتقان الاتصال الشفهي والكتابي، استخدام التحليل الكمي، وتوظيف الحاسب الآلي في المهام المالية.
\n\n<b>💼 الفرص الوظيفية:</b>
يشمل العمل في:
•   المنشآت الاقتصادية، البنوك (تجارية وإسلامية)، شركات التأمين، البنك المركزي السعودي، مكاتب الصرافة.
•   القطاعات المالية بالجهات الحكومية، وزارة المالية.
\n<b>أمثلة للوظائف:</b>
•   أمين صندوق، مأمور صرف، مساعد مدير مالي، مراقب مالي، مدقق حسابات، محصل إيرادات، مراقب تجاري.
وغيرها من الوظائف ذات الصلة بالمجال المالي والمصرفي.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الإدارة المالية والمصرفية: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات للدبلوم المتوسط في الإدارة المالية والمصرفية: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/dblwm_ldr_lmly_wlmsrfy.pdf\">عرض الوصف</a>"
        },
        "دبلوم الوسائط المتعددة التفاعلية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الوسائط المتعددة التفاعلية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر وطنية متخصصة في الوسائط المتعددة التفاعلية، قادرة على العمل ضمن فرق متعددة التخصصات، والمساهمة في دعم التحول الرقمي وتحقيق رؤية المملكة 2030.
\n<b>🎯 الأهداف:</b>
• تأهيل طلاب متخصصين في تصميم وتطوير الوسائط التفاعلية.
• ربط مخرجات البرنامج بمتطلبات سوق العمل الرقمي.
• تزويد الطلاب بأحدث المهارات التقنية والتطبيقات العملية.
• تعزيز الابتكار والتميّز في التصميم الرقمي.
• دعم التميز المحلي والإقليمي في مجالات الوسائط الرقمية.
\n\n<b>💼 الفرص الوظيفية:</b>
• تصميم وإنتاج الوسائط المتعددة والتصميم ثلاثي الأبعاد.
• شركات إنتاج الألعاب الإلكترونية والرسوم المتحركة.
• شركات تطوير مواقع الويب والتطبيقات التفاعلية.
• المؤسسات الإعلامية التقليدية والرقمية.
• شركات الدعاية والإعلان والإنتاج الإبداعي.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الوسائط المتعددة التفاعلية: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في الوسائط المتعددة التفاعلية: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_dblwm_lskrtry_ltby.pdf\">عرض الوصف</a>"
        },
        "دبلوم الامن السيبراني": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الأمن السيبراني – جامعة الملك سعود</b>
<b>مقدمة:</b>
يُعد الأمن السيبراني من المجالات الحيوية لحماية الأنظمة والشبكات والبرامج من الهجمات الإلكترونية، وحماية المستخدمين من الابتزاز ومقاطعة العمليات التجارية. الحاجة ملحة لكوادر وطنية مؤهلة لمواجهة هذه التحديات.
\n\n<b>🎯 الأهداف العامة:</b>
• تزويد الطالب بالمهارات الأساسية في أمن المعلومات والجرائم الإلكترونية.
• تأهيل الطالب للتعامل مع القضايا الأخلاقية والقانونية.
• تنمية قدرة الطالب على اكتشاف نقاط الضعف في الشبكات.
• تعليم الطالب أساليب صد الهجمات الإلكترونية وحماية الأنظمة.
• تأهيل الطالب لمهارات التحقيقات الجنائية الرقمية وتحليل الأدلة.
\n\n<b>💼 مخرجات البرنامج وفرص العمل:</b>
• أمن المعلومات، تقنية المعلومات، أمن الشبكات، أمن الإنترنت.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الأمن السيبراني: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%81%D8%A3%D9%85%D9%86_%D8%A7%D9%84%D9%81%D8%B3%D9%8A%D8%A8%D8%B1%D8%A7%D9%86%D9%8A_0.pdf\">عرض الخطة</a>"
        },
        "دبلوم السكرتارية التنفيذية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في السكرتارية التنفيذية – جامعة الملك سعود</b>
يهدف البرنامج إلى تأهيل الطلاب بالمهارات والمعارف اللازمة لأداء مهام السكرتارية التنفيذية بكفاءة عالية.
\n\n<b>🗂 الخطة الدراسية تتضمن:</b>
• مهارات الاتصال الفعال، إدارة المكاتب وتنظيم العمل، تقنيات الحاسوب وبرامج الأوفيس، إدارة الاجتماعات وتنظيم الفعاليات، مهارات كتابة التقارير والمراسلات، قواعد السلوك المهني وأخلاقيات العمل، إدارة الوقت والمهام، التخطيط والتنظيم الإداري.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في السكرتارية التنفيذية: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>"
        },
        "دبلوم تقنية النظارات": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط فني تقنية النظارات – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تخريج فنيي نظارات سعوديين مؤهلين علمياً وعملياً ليكونوا جزءاً فعالاً من فريق الرعاية البصرية في المملكة، بما يدعم رؤية 2030 لتوطين قطاع البصريات ورفع جودة الخدمات.
\n\n<b>🎯 الأهداف:</b>
• إعداد فنيين مؤهلين للعمل مع أطباء العيون ودكاترة البصريات.
• إتقان المهارات الإدارية المتعلقة بالبيع والتسويق.
• توطين نشاط قطاع البصريات ورفع مستوى الخدمات.
\n\n<b>📘 المخرجات:</b>
• كوادر فنية ماهرة في قص العدسات وتنفيذ الأعمال الفنية.
• كوادر قادرة على إرشاد وتلبية احتياجات مراجعي محال البصريات.
• كوادر إدارية متخصصة في مجالات البيع، الإدارة، والتسويق.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط فني تقنية النظارات: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%AA%D9%82%D9%86%D9%8A%D8%A9_%D8%A7%D9%84%D9%86%D8%B8%D8%A7%D8%B1%D8%A7%D8%AA_0.pdf\">عرض الخطة</a>"
        },
        "دبلوم إدارة الموارد البشرية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في إدارة الموارد البشرية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تأهيل الطلاب علمياً وعملياً لسوق العمل في هذا المجال، بتزويدهم بالمعارف والمهارات اللازمة للأداء بكفاءة وفعالية، بما يتوافق مع احتياجات سوق العمل السعودي.
\n\n<b>🎯 الأهداف:</b>
• تزويد الطلاب بالمعارف والمهارات في إدارة الموارد البشرية.
• غرس السلوكيات والأخلاقيات المهنية.
• مواكبة احتياجات سوق العمل لتعزيز فرص التوظيف.
• تحسين جودة البرنامج بما يتماشى مع معايير الاعتماد.
• تطوير بيئة أكاديمية وإدارية متميزة.
• بناء شراكات فعالة مع منظمات الأعمال والمؤسسات الحكومية.
\n\n<b>💼 الفرص الوظيفية:</b>
• العمل في القطاع الحكومي، الخاص، والمنظمات غير الربحية، في مجالات: التوظيف والتدريب، استراتيجيات الموارد البشرية، تخطيط القوى العاملة، التعويضات، إدارة أنشطة التوظيف، تطوير المسار الوظيفي، والعلاقات العمالية.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في إدارة الموارد البشرية: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%AA%D9%82%D9%86%D9%8A%D8%A9_%D8%A7%D9%84%D9%86%D8%B8%D8%A7%D8%B1%D8%A7%D8%AA\">عرض الخطة</a>" # الرابط الأصلي يشير إلى "تقنية النظارات"
        },
        "دبلوم المحاسبة الضريبية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في المحاسبة الضريبية – جامعة الملك سعود</b>
<b>الخطة الدراسية:</b>
توفر الخطة الدراسية مقررات متخصصة تهدف إلى تأهيل الطلاب بفهم شامل ومتقدم لأنظمة المحاسبة الضريبية والتشريعات المتعلقة بها، بما يمكنهم من العمل بكفاءة في المجالات المحاسبية والضريبية.
""",
            "الخطة الدراسية": "الخطة الدراسية لدبلوم المحاسبة الضريبية: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في السكرتارية الطبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_dblwm_lskrtry_ltby.pdf\">عرض الوصف</a>"
        },
        "دبلوم الترجمة بلغة الإشارة": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الترجمة بلغة الإشارة – جامعة الملك سعود</b>
\n\n<b>🎯 الأهداف:</b>
• إعداد وتأهيل كوادر متخصصة في تقديم خدمات ترجمة لغة الإشارة للأشخاص الصم وضعاف السمع.
• تأهيل العاملين في القطاعين الحكومي والخاص لاكتساب مهارات لغة الإشارة.
• توفير بيئة أكاديمية متخصصة تقدم الكفايات المهنية.
• تدريب العاملين على أخلاقيات ترجمة لغة الإشارة.
• تقديم مرجعية علمية واستشارية لبرامج لغة الإشارة.
• تمكين البرنامج ليكون المرجع الرئيسي لإعداد وتدريب العاملين مع الصم.
• التنسيق مع الجهات المعنية لتقديم دورات تدريبية مستمرة.
• منح تراخيص لمترجمي لغة الإشارة.
\n\n<b>💼 الفرص الوظيفية:</b>
• مرشدين ومترجمين في المعارض والمؤتمرات.
• العمل في المؤسسات الإعلامية وقنوات التلفزيون.
• العمل في الجهات المختصة بالشؤون الاجتماعية والجمعيات.
• التوظيف في المحاكم والجهات القانونية.
• العمل في الجهات الحكومية والخدمية والقطاع الخاص.
• العمل في مراكز خدمات الصم وضعاف السمع.
• العمل في الجهات التعليمية.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الترجمة بلغة الإشارة: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في السكرتارية الطبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_dblwm_lskrtry_ltby.pdf\">عرض الوصف</a>"
        },
        "دبلوم مقدمي الرعاية بالحضانات": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المشارك لمقدمي الرعاية بالحضانات – جامعة الملك سعود</b>
\n\n<b>🌟 مقدمة البرنامج:</b>
تُعد مرحلة الطفولة المبكرة (من الميلاد حتى 3 سنوات) من أهم المراحل، وتوفير رعاية وتعليم عالي الجودة للأطفال مسؤولية كبيرة. البرنامج يركز على تدريب وتأهيل مقدمات رعاية الأطفال في الحضانة، معتمدًا على أفضل البرامج والممارسات العالمية.
\n\n<b>🎯 الخطة الدراسية:</b>
تتضمن مقررات نظرية وعملية لتطوير مهارات مقدمات الرعاية في مختلف جوانب التعامل مع الأطفال.
\n\n<b>💼 الفرص الوظيفية:</b>
• مقدمات رعاية الأطفال في الحضانات، مديرات الحضانة، مشرفات على الحضانة.
""",
            "الخطة الدراسية": "الخطة الدراسية لدبلوم المشارك لمقدمي الرعاية بالحضانات: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D9%85%D9%82%D8%AF%D9%85%D9%8A_%D8%A7%D9%84%D8%B1%D8%B9%D8%A7%D9%8A%D8%A9.pdf\">عرض الخطة</a>"
        },
        "دبلوم اللغة الصينية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في اللغة الصينية – جامعة الملك سعود</b>
\n\n<b>🎯 الأهداف التعليمية:</b>
• اكتساب أساسيات اللغة الصينية بطريقة متقنة.
• استخدام المفردات والتراكيب اللغوية وقواعدها كتابياً وشفوياً.
• التعرف على الثقافة الصينية والرموز ذات الدلالة.
• الإلمام بمصطلحات وتعبيرات متنوعة في مجالات التجارة، الاقتصاد، السفر، والسياحة.
\n\n<b>💼 الفرص الوظيفية:</b>
• العمل في مجالات الترجمة واللغات.
• تطوير مهارات موظفي الجهات المختلفة.
• المشاركة في برامج التبادل الثقافي والتجاري.
• تلبية احتياجات الجهات التي تسعى لمواكبة التطور في لغات العصر.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في اللغة الصينية: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في السكرتارية الطبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_dblwm_lskrtry_ltby.pdf\">عرض الوصف</a>"
        },
        "الدبلوم المشارك في العمل الخيري": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>دبلوم المشارك في العمل الخيري – جامعة الملك سعود</b>
\n\n<b>🎯 الأهداف:</b>
• دعم وتطوير قطاع العمل الخيري عبر تأهيل كوادر بشرية متميزة.
• تزويد الطلبة بأحدث المعارف والنظريات في إدارة العمل الخيري.
• التعرف على الأساليب العلمية لإعداد البحوث والدراسات.
• رفد القطاعين الخيري والتنموي بإداريين مبدعين.
• نشر ثقافة التنمية المستدامة والمسؤولية الاجتماعية.
\n\n<b>💼 الفرص الوظيفية:</b>
• مؤسسات العمل الخيري، الأوقاف، المنظمات غير الحكومية.
• الجهات الحكومية التابعة لوزارة العمل والشؤون الاجتماعية.
""",
            "وصف المقررات": "وصف المقررات لدبلوم المشارك في العمل الخيري: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_brnmj_dblwm_lml_lkhyry.pdf\">عرض الوصف</a>"
        }
    },
    "تخصصات برامج الدبلوم - عن بُعد": {
        "menu_text": "الرجاء اختيار تخصص الدبلوم عن بُعد:",
        "options": [
            "شرح - البلاك بورد / Blackboard",
            "دبلوم الإدارة المالية والمصرفية - عن بعد.",
            "دبلوم إدارة أعمال التأمين - عن بعد.",
            "دبلوم التسويق – عن بعد",
            "خدمات طلابية ، متابعة الاعمال الفصلية",
            "كتب و ملخصات مواد الدبلوم عن بعد 📚 PDF",
            "🔙 رجوع"
        ],
        "شرح - البلاك بورد / Blackboard": """✅️ كل ما تريد معرفته حول منصة التعليم عن بُعد البلاك بوورد تجده هنا:👇

1. طريقة الدخول الى المحاضرة المباشرة: <a href="https://t.me/Diploma_Solutions/6">شرح الدخول</a>

2. طريقة حضور المحاضرات المسجلة: <a href="https://t.me/Diploma_Solutions/8">شرح الحضور</a>

3. طريقة حل المناقشات: <a href="https://t.me/Diploma_Solutions/10">شرح حل المناقشات</a>

4. طريقة حل الواجب: <a href="https://t.me/Diploma_Solutions/7">شرح حل الواجب</a>

5. طريقة حل التقييم الذاتي: <a href="https://t.me/Diploma_Solutions/12">شرح حل التقييم الذاتي</a>

🛑مقطع فيديو شرح استخدام -البلاك بورد/ Blackboard -> <a href="https://t.me/Diploma_Solutions/16">عرض الفيديو</a>

• للدخول هنا قروب - مستجدين الدبلوم👇🏻
<a href="https://t.me/Diploma_New_1447">قروب مستجدين الدبلوم</a>

♻️ قروبات -استفسارات الدبلوم ↪️
<a href="https://t.me/book_KSU_1447">قروبات استفسارات الدبلوم</a>

◆بوت المساعدة - دبلوم جامعة الملك سعود->
<a href="https://t.me/KingSaudDiploma_bot">بوت المساعدة</a>""",
        "دبلوم الإدارة المالية والمصرفية - عن بعد.": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🎓 <b>الدبلوم المتوسط في الإدارة المالية والمصرفية – جامعة الملك سعود</b>
يهدف البرنامج إلى إعداد كوادر مؤهلة في المالية والمصرفية، قادرة على مواكبة التغيرات الاقتصادية وتلبية احتياجات سوق العمل.
\n\n<b>🎯 الأهداف:</b>
1.  إكساب المعرفة بالمفاهيم والمبادئ والأنظمة المالية والمصرفية.
2.  تأهيل الطلاب للتطورات الحديثة في القطاع.
3.  إعداد الخريجين لوظائف متنوعة في المؤسسات المالية والبنكية.
4.  تنمية مهاراتهم التحليلية، التواصلية، والرقمية.
\n\n<b>📘 المخرجات:</b>
•   فهم الأدوات المالية، التحليل المالي، أنواع المؤسسات والأسواق المالية، وأساسيات الإدارة المالية والاستثمار.
•   القدرة على تحليل البيانات المالية، التنبؤ بالمخاطر، وحل القضايا المالية.
•   الالتزام بالأخلاقيات المهنية والعمل الجماعي.
•   إتقان الاتصال الشفهي والكتابي، استخدام التحليل الكمي، وتوظيف الحاسب الآلي في المهام المالية.
\n\n<b>💼 الفرص الوظيفية:</b>
يشمل العمل في:
•   المنشآت الاقتصادية، البنوك (تجارية وإسلامية)، شركات التأمين، البنك المركزي السعودي، مكاتب الصرافة.
•   القطاعات المالية بالجهات الحكومية، وزارة المالية.
\n<b>أمثلة للوظائف:</b>
•   أمين صندوق، مأمور صرف، مساعد مدير مالي، مراقب مالي، مدقق حسابات، محصل إيرادات، مراقب تجاري.
وغيرها من الوظائف ذات الصلة بالمجال المالي والمصرفي.
""",
            "الخطة الدراسية": "◆ الخطة الدراسية للدبلوم المتوسط في الإدارة المالية والمصرفية: <a href=\"https://drive.google.com/file/d/11Re6r3MibiqyMxrlg0jh-X_SZGrOu5Cb/view?usp=drivesdk\">عرض الخطة الدراسية</a>",
            "وصف المقررات": "◆ وصف مقررات دبلوم الإدارة المالية والمصرفية <a href=\"https://drive.google.com/file/d/11OtBZQauC278G2cqTkh2fSruXLHrqlf3/view?usp=drivesdk\">عرض الوصف</a>"
        },
        "دبلوم إدارة أعمال التأمين - عن بعد.": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🎓 <b>الدبلوم المتوسط في إدارة أعمال التأمين</b> – <b>جامعة الملك سعود</b>
🔹 <b>أهداف البرنامج:</b>
• إكساب الطلاب المبادئ الفنية والإجراءات العملية لصناعة التأمين.
• تأهيل الطلاب لمواكبة التطورات في قطاع التأمين.
• إعداد خريجين مؤهلين للعمل في الوظائف التأمينية.
• تطوير المهارات العلمية والعملية اللازمة لأداء المهام الوظيفية.
🔹 <b>مخرجات تعلم البرنامج:</b>
<b>📘 المعرفة:</b>
• التعرف على أنواع التأمين وأهميتها.
• تحليل وقياس الأخطار واختيار طرق التعامل معها.
• فهم الأسس الفنية والقانونية للتأمين.
• متابعة التطورات المهنية والتقنية في قطاع التأمين.
<b>🧠 المهارات المعرفية:</b>
• تحليل مشكلات التأمين وتقديم حلول منطقية.
• تسويق الخدمات التأمينية باستخدام مهارات الاتصال.
• استخدام المعرفة التقنية في اتخاذ القرارات العملية.
• فهم الآثار المترتبة على قرارات التأمين.
<b>🤝 المهارات الشخصية والمسؤولية:</b>
• الالتزام بالقيم الأخلاقية.
• الاستعداد لتحمل مسؤوليات العمل التأميني.
• القدرة على تقييم الذات وتطوير التعلم المستمر.
<b>📊 المهارات التقنية والعددية:</b>
• تحليل وتقديم البيانات شفهياً وكتابياً.
• تطبيق الأساليب الإحصائية في حل المشكلات.
• استخدام التقنية في البحث والتحليل والعرض.
📌 <b>ملاحظة:</b>
جميع المعلومات الخاصة بتخصصات <i>الدبلوم الحضوري</i> و<i>الدبلوم عن بُعد</i> متوفرة داخل البوت منعًا للتشتت وكثرة الرسائل.""",
            "الخطة الدراسية": "◆ الخطة الدراسية الدبلوم المتوسط في إدارة أعمال التأمين: <a href=\"https://drive.google.com/file/d/11lvBlBykFUFn-3gvjqpojfmuE7BZ1nW_/view?usp=drivesdk\">عرض الخطة الدراسية</a>",
            "وصف المقررات": "◆ وصف مقررات الدبلوم المتوسط في إدارة أعمال التأمين <a href=\"https://drive.google.com/file/d/11OtBZQauC278G2cqTkh2fSruXLHrqlf3/view?usp=drivesdk\">عرض الوصف</a>"
        },
        "دبلوم التسويق – عن بعد": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """شكرًا لتوفير هذه المعلومات. إليك <b>ملخصًا منسقًا</b> لتخصص <b>الدبلوم المتوسط في التسويق "عن بُعد"</b>، يمكن استخدامه في العروض أو الملفات التعريفية:
<b>🧾 الدبلوم المتوسط في التسويق "عن بُعد" – جامعة الملك سعود</b>
<b>🎯 الأهداف العامة والفرعية:</b>
• إعداد الطلاب للعمل بكفاءة واحترافية في الوظائف التسويقية.
• تأهيل نظري وعملي في التسويق الحديث وتطبيقاته.
• تنمية المهارات العملية واستخدام التقنية في اتخاذ القرار.
• تعزيز الفهم للمفاهيم التسويقية والتحديات الميدانية.
• تهيئة الخريجين نفسيًا ومهنيًا لسوق العمل.
<b>📘 المخرجات المعرفية:</b>
• إتقان المصطلحات والمفاهيم والتقنيات التسويقية.
• فهم القضايا المعاصرة في بيئات التسويق.
• التمكن من أدوات وتقنيات البحث التسويقي.
• فهم أدوات وتقنيات التسويق داخليًا وخارجيًا.
• إدراك دور التكنولوجيا في ممارسات التسويق.
<b>🛠 ️ المخرجات المهارية:</b>
• العمل بكفاءة ضمن فرق أو بشكل فردي.
• الالتزام بالمعايير الأخلاقية في التسويق.
• التواصل الفعّال كتابيًا وشفويًا باستخدام التقنية.
• استخدام التحليل الكمي والبيانات في حل المشكلات.
<b>💼 الفرص الوظيفية:</b>
يمكن لخريجي الدبلوم العمل في القطاعين الحكومي والخاص في الوظائف التالية:
• مأمور مبيعات
• مساعد مدرب (في التسويق)
• مدقق مشتريات مساعد
• محصل إيرادات
• مأمور مشتريات
• مراقب تجاري
• كاتب في إدارة التسويق
📌 <b>لمزيد من التفاصيل حول برامج الدبلوم (حضوري وعن بُعد):</b>""",
            "الخطة الدراسية": "◆ الخطة الدراسية الدبلوم المتوسط في التسويق: <a href=\"https://drive.google.com/file/d/11yZhKDyLJUiEMS4sW9MTLcnjwnXibB4G/view?usp=drivesdk\">عرض الخطة الدراسية</a>",
            "وصف المقررات": "◆ وصف مقررات الدبلوم المتوسط في التسويق: <a href=\"https://drive.google.com/file/d/11onug3ZiaUdW_B6v504xAiVQXU0AIv43/view?usp=drivesdk\">عرض الوصف</a> • للمزيد: <a href=\"https://t.me/Diploma_Solutions/23\">شرح إضافي على تيليجرام</a>"
        },
        "خدمات طلابية ، متابعة الاعمال الفصلية": """🎯 خدمة الاشتراك في حلول ومتابعة الأعمال الفصلية
هل وقتك ضيّق؟ هل تجد صعوبة في متابعة المهام الجامعية؟ 🤯
📚 لا تقلق! اشترك الآن في خدمة متابعة الأعمال الفصلية وكن مطمئنًا على درجاتك طوال الترم.
✅ الاشتراك يشمل:
• 🔹 حل جميع الواجبات والمناقشات والمشاريع.
• 🔹 حل الاكتيفيتي الأسبوعي بانتظام.
• 🔹 حل الكويزات والاختبارات القصيرة والذاتية.
• 🔹 إرسال تقارير أسبوعية أو شهرية توضح ما تم إنجازه.
• 🔹 ضمان كامل درجات أعمال الفصل لكل مادة.
📌 اشترك وارتاح من القلق والتأخير!
🎓 الخدمة مقدّمة باحترافية وسرية تامة
📲 للتواصل والاشتراك:
عبر واتساب:
<a href="https://wa.me/967733365187">منصة عون الأكاديمية - تواصل واتساب</a>
✍️ دمتم بود وتوفيق دائم بإذن الله 🌿""",
        "كتب و ملخصات مواد الدبلوم عن بعد 📚 PDF": """قناه خاصه كتب وملخصات وتجميعات والاختبارات الذاتية مواد دبلوم جامعة سعودKSU) )
📌 رابط قناة مستجدين دبلوم الملك سعود
<a href="https://t.me/Diploma_New_1447">قناة مستجدين دبلوم الملك سعود</a>
رابط القناة
<a href="https://t.me/KDiplomasSU">قناة الكتب والملخصات</a>"""
    },
    "قروبات التخصص": """
🔶<b>قروبات الدبلوم _ عن بعد</b>🔶

📌قروب دبلوم ادارة اعمال التأمين/ كل المستويات: <a href="https://t.me/Remote_KSU">اضغط هنا للانضمام</a>

📌قروب دبلوم المصرفية والتأمين /كل المستويات: <a href="https://t.me/KSU_1447">اضغط هنا للانضمام</a>

📌 قروب دبلوم التسويق والمبيعات/ كل المستويات: <a href="https://t.me/+FdHNuh6x_EkyOGI0">اضغط هنا للانضمام</a>

📌قروب دبلوم الموارد البشرية عن بعد كل المستويات: <a href="https://t.me/Human_KSU_1447">اضغط هنا للانضمام</a>

📌 كتب وملخصات مواد الدبلوم: <a href="https://t.me/KDiplomasSU">اضغط هنا للانضمام</a>

📌 قناة اخبار دبلوم جامعة سعود: <a href="https://t.me/KSDN_222">اضغط هنا للانضمام</a>

📌 بوت المساعدة - دبلوم جامعة الملك سعود: <a href="https://t.me/KingSaudDiploma_bot">اضغط هنا لبدء المحادثة</a>

<b>................................................................</b>
""",
    "قروبات المواد للمستجدين": """
⚜️◾<b>قروبات مواد الدبلوم للمستجدين</b>◾⚜️

🔗قروب عام مستجدين دبلوم سعود: <a href="https://t.me/Diploma_New_1447">اضغط هنا للانضمام</a>

📌قروب اللغة الإنجليزية(1): <a href="https://t.me/English_1447">اضغط هنا للانضمام</a>

📌قروب اللغة الإنجليزية(2): <a href="https://t.me/English2_1447">اضغط هنا للانضمام</a>

📌قروب مهارات الحاسب الالي(1): <a href="https://t.me/Computer_Skills_1447">اضغط هنا للانضمام</a>

📌قروب مهارات الحاسب الالي(2): <a href="https://t.me/ComputerSkills_1447">اضغط هنا للانضمام</a>

📌مهارات التعليم والتفكير والبحث: <a href="https://t.me/Teaching_skills_1447">اضغط هنا للانضمام</a>

📌 مقدمة في الإحصاء: <a href="https://t.me/introduction_1447">اضغط هنا للانضمام</a>

📌مبادئ الادارة المالية: <a href="https://t.me/Management_1447">اضغط هنا للانضمام</a>

📌 اللياقة والثقافة والصحية: <a href="https://t.me/Fitness_culture_1447">اضغط هنا للانضمام</a>

📌مبادئ إدارة الأعمال: <a href="https://t.me/Management_3352">اضغط هنا للانضمام</a>

♻️كتب وملخصات مواد الدبلوم: <a href="https://t.me/KDiplomasSU">اضغط هنا للانضمام</a>

⚜️قناة أخبار الدبلوم⚜️: <a href="https://t.me/KSDN_222">اضغط هنا للانضمام</a>

<b>...............................</b>
""",
    "كتب وملخصات مواد الدبلوم": {
        "menu_text": "الرجاء اختيار المستوى الدراسي:",
        "options": [
            "📘1⃣- مستوى أول",
            "📘2⃣‐مستوى ثاني",
            "🔙 رجوع"
        ],
        "📘1⃣- مستوى أول": {
            "menu_text": """<b>📖📚 كتب وملخصات مواد الدبلوم (المستوى الأول)</b>""",
            "content": """◆مهارات اللغة الإنجليزية (1): <a href="https://t.me/KDiplomasSU/807">عرض الملخصات</a>

◆مهارات التعلم والتفكير والبحث: <a href="https://t.me/KDiplomasSU/428">عرض الملخصات</a>

◆مهارات الحاسب 1: <a href="https://t.me/KDiplomasSU/417?single">عرض الملخصات</a>

◆اللياقة والثقافة الصحية: <a href="https://t.me/KDiplomasSU/433?single">عرض الملخصات</a>

◆مقدمة في الإحصاء: <a href="https://t.me/KDiplomasSU/465?single">عرض الملخصات</a>

♻️كتب وملخصات مواد الدبلوم: <a href="https://t.me/KDiplomasSU">اضغط هنا للانضمام</a>

⚜️قناة أخبار الدبلوم⚜️: <a href="https://t.me/KSDN_222">اضغط هنا للانضمام</a>

<b>...............................</b>
""",
    "كتب وملخصات مواد الدبلوم": {
        "menu_text": "الرجاء اختيار المستوى الدراسي:",
        "options": [
            "📘1⃣- مستوى أول",
            "📘2⃣‐مستوى ثاني",
            "🔙 رجوع"
        ],
        "📘1⃣- مستوى أول": {
            "menu_text": """<b>📖📚 كتب وملخصات مواد الدبلوم (المستوى الأول)</b>""",
            "content": """◆مهارات اللغة الإنجليزية (1): <a href="https://t.me/KDiplomasSU/807">عرض الملخصات</a>

◆مهارات التعلم والتفكير والبحث: <a href="https://t.me/KDiplomasSU/428">عرض الملخصات</a>

◆مهارات الحاسب 1: <a href="https://t.me/KDiplomasSU/417?single">عرض الملخصات</a>

◆اللياقة والثقافة الصحية: <a href="https://t.me/KDiplomasSU/433?single">عرض الملخصات</a>

◆مقدمة في الإحصاء: <a href="https://t.me/KDiplomasSU/465?single">عرض الملخصات</a>

✅قروب المستجدين: <a href="https://t.me/Diploma_New_1447">اضغط هنا للانضمام</a>

○بوت المساعدة - دبلوم جامعة الملك سعود: <a href="https://t.me/KingSaudDiploma_bot">اضغط هنا لبدء المحادثة</a>

‏♻️ #انشرها_قد_يحتاجها_غيرك 😇💖🙏
""",
            "options": ["🔙 رجوع"]
        },
        "📘2⃣‐مستوى ثاني": {
            "menu_text": """<b>📖📚 كتب وملخصات مواد الدبلوم (المستوى الثاني)</b>""",
            "content": """◆مبادئ إدارة الأعمال: <a href="https://t.me/KDiplomasSU/483?single">عرض الملخصات</a>

◆مبادئ الادارة المالية: <a href="https://t.me/KDiplomasSU/493?single">عرض الملخصات</a>

◆مبادئ التأمين: <a href="https://t.me/KDiplomasSU/491">عرض الملخصات</a>

◆مبادئ التسويق: <a href="https://t.me/KDiplomasSU/765">عرض الملخصات</a>

◆مبادئ المحاسبة: <a href="https://t.me/KDiplomasSU/476">عرض الملخصات</a>

◆مبادئ الاقتصاد: <a href="https://t.me/KDiplomasSU/813">عرض الملخصات</a>

◆مهارات الحاسب (2): <a href="https://t.me/KDiplomasSU/496?single">عرض الملخصات</a>

● النظام الاقتصادي الإسلامي: <a href="https://t.me/KDiplomasSU/812">عرض الملخصات</a>

● قضايا معاصرة: <a href="https://t.me/KDiplomasSU/503?single">عرض الملخصات</a>

● نظام العمل والتأمينات الاجتماعية: <a href="https://t.me/KDiplomasSU/508">عرض الملخصات</a>

♻️كتب و ملخصات مواد الدبلوم: <a href="https://t.me/KDiplomasSU">قناة الكتب والملخصات</a>

◆بوت المساعدة - دبلوم جامعة الملك سعود: <a href="https://t.me/KingSaudDiploma_bot">اضغط هنا لبدء المحادثة</a>
""",
            "options": ["🔙 رجوع"]
        }
    },
    "قناة وإعلانات الدبلوم 📢": """<b>♦ قناة أخبار دبلومات جامعة الملك سعود:</b>
• 🔗 رابط القناة: <a href="https://t.me/KSDN_222">قناة أخبار دبلومات جامعة الملك سعود</a>

<b>♦ قناة تابعة لقروب دبلوم جامعة الملك سعود:</b>
قناة خاصة بحلول واجبات واختبارات مواد الدبلوم بجامعة الملك سعود KSU
• 🔗 رابط القناة: <a href="https://t.me/Diploma_Solutions">قناة حلول الواجبات والاختبارات</a>""",
    "خدمات حل الواجبات وعمل المشاريع والبحوث": """🎓 <b>منصة عونك الأكاديمية – لجميع طلاب دبلومات جامعة الملك سعود</b>
🔸 <i>سواء كنت طالبًا مستجدًا أو في أحد المستويات المتقدمة، وفرنا لك كل ما تحتاجه في مكانٍ واحد.</i>

💼 <b>خدماتنا تشمل:</b>
• ✅ حل الواجبات الأكاديمية بجودة عالية
• ✅ إعداد البحوث والتقارير الاحترافية (Word | PDF | Excel)
• ✅ تصميم العروض التقديمية PowerPoint بأسلوب مميز
• ✅ تنفيذ المشاريع الدراسية بدقة واحترافية
• ✅ دعم كامل في الأعمال الفصلية ومهام المواد

🧠 نضم فريقًا من <b>المتخصصين الأكاديميين</b> في مختلف المجالات، نختار الأنسب لطلبك لضمان أعلى جودة ممكنة.

📌 <b>تابع قنواتنا الرسمية لجميع الخدمات الطلابية:</b>
• 🔗 <a href="https://t.me/Diploma_Solutions">قناة حلول الدبلوم</a>
• 🔗 <a href="https://t.me/Aoun_Academic">منصة عون الأكاديمية</a>

💬 <b>للتواصل وطلب الخدمات مباشرة:</b>
• 🔗 <a href="https://wa.me/967733365187">اضغط هنا للتواصل عبر الواتساب</a>

⭐️ <i>جودة، سرعة، خصوصية – لأن نجاحك هو هدفنا.</i>
✍️ <b>معكم خطوة بخطوة حتى التخرج – دمتم بخير 🌿</b>""",
    "مواقع فروع جامعة الملك سعود": """⚪️ <b>مواقع فروع جامعة الملك سعود</b>
• 🔸 جامعة الملك سعود (عليشة بنات): <a href="https://maps.app.goo.gl/nHSKPBWHqAdvspmz8?g_st=it">عرض على الخريطة</a>
• 🔸 جامعة الملك سعود (الروابي - مشترك): <a href="https://maps.app.goo.gl/1Xf9MqXCPs9fVkng7?g_st=it">عرض على الخريطة</a>
• 🔸 جامعة الملك سعود (المبنى الرئيسي - تركي الأول): <a href="https://maps.app.goo.gl/NjeJTWoj4mhK5MUKA?g_st=it">عرض على الخريطة</a>
• 🔸 جامعة الملك سعود (الملز): <a href="https://maps.app.goo.gl/4bnaxNA8vMDRSp9D7">عرض على الخريطة</a>
• 🔸 جامعة الملك سعود (الوشم - عيال): <a href="https://maps.app.com/sCo9BkV1WaEeXVGa8?g_st=it">عرض على الخريطة</a>
• 🔸 جامعة الملك سعود (المدينة الجامعية للطالبات): <a href="https://maps.me/EZcL9XVz1w8UomYF6?g_st=ic">عرض على الخريطة</a>""",
    "شروط التجسير في جامعة الملك سعود": """شروط التجسير في جامعة الملك سعود
<a href="https://t.me/Diploma_Solutions/24">عرض الشروط على تيليجرام</a>""",
    "🛑شرح استخدام – البلاك بورد / Blackboard 🛑": """✅️ كل ما تريد معرفته حول منصة التعليم عن بُعد البلاك بوورد تجده هنا:👇

1. طريقة الدخول الى المحاضرة المباشرة: <a href="https://t.me/Diploma_Solutions/6">شرح الدخول</a>

2. طريقة حضور المحاضرات المسجلة: <a href="https://t.me/Diploma_Solutions/8">شرح الحضور</a>

3. طريقة حل المناقشات: <a href="https://t.me/Diploma_Solutions/10">شرح حل المناقشات</a>

4. طريقة حل الواجب: <a href="https://t.me/Diploma_Solutions/7">شرح حل الواجب</a>

5. طريقة حل التقييم الذاتي: <a href="https://t.me/Diploma_Solutions/12">شرح حل التقييم الذاتي</a>

🛑مقطع فيديو شرح استخدام -البلاك بورد/ Blackboard -> <a href="https://t.me/Diploma_Solutions/16">عرض الفيديو</a>

• للدخول هنا قروب - مستجدين الدبلوم👇🏻
<a href="https://t.me/Diploma_New_1447">قروب مستجدين الدبلوم</a>

♻️ قروبات -استفسارات الدبلوم ↪️
<a href="https://t.me/book_KSU_1447">قروبات استفسارات الدبلوم</a>

◆بوت المساعدة - دبلوم جامعة الملك سعود->
<a href="https://t.me/KingSaudDiploma_bot">بوت المساعدة</a>""",
    "🤖 اسأل الذكاء الاصطناعي": {
        "menu_text": "أهلاً بك في وضع الدردشة مع الذكاء الاصطناعي! 🤖\nيمكنك الآن طرح أي سؤال أو إرسال صورة وسأجيبك.\n\nللعودة إلى القائمة الرئيسية للبوت، اضغط على زر '🔙 رجوع'.",
        "options": ["🔙 رجوع"]
    }
}

# Helper function to create a ReplyKeyboardMarkup
def create_keyboard(buttons):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    # Check if the buttons list is a list of lists (for multiple rows) or a single list
    if all(isinstance(button_row, list) for button_row in buttons):
        for button_row in buttons:
            markup.row(*button_row)
    else:
        for button in buttons:
            markup.add(button)
    return markup

# Function to get the main keyboard
def get_main_keyboard():
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.row(*left_commands)
    for tab in right_tabs:
        markup.add(tab)
    return markup

# --- رسالة ترحيب عند /start ---
@bot.message_handler(commands=['start'])
def start_handler(message):
    chat_id = message.chat.id
    user_states[chat_id] = "main_menu" # تعيين حالة المستخدم إلى القائمة الرئيسية
    text = (
        "🔹 <b>ما الذي يمكن لهذا البوت تقديمه؟</b>\n\n"
        "هذا البوت مُخصص لطلاب <b>الدبلوم في جامعة الملك سعود</b>، ويهدف إلى:\n\n"
        "✅ <b>توفير المعلومات الدراسية بسهولة وسرعة</b>\n"
        "✅ <b>مساعدة الطالب في الوصول لكل ما يحتاجه من روابط ومصادر مهمة</b>\n"
        "✅ <b>تقليل الوقت والجهد المبذول في البحث</b>\n"
        "✅ <b>تجميع كل ما يهم الطالب في مكان واحد</b>\n\n"
        "نأمل أن تكون هذه الخدمة عند حسن ظنكم،\n"
        "ونسعد دائمًا بخدمتكم 💙\n"
        "<b>\"جزيل الشكر والتقدير لكم 🌹\"</b>\n\n"
        "قناة مساعدات طلاب الدبلوم 👇\n"
        "<a href=\"https://t.me/Diploma_Solutions\">اضغط هنا للانضمام للقناة</a>"
    )
    bot.send_message(chat_id, text, parse_mode="HTML", reply_markup=get_main_keyboard())

# --- التعامل مع أوامر اليسار (star, help) ---
@bot.message_handler(func=lambda m: m.text in left_commands)
def left_command_handler(message):
    chat_id = message.chat.id
    text = message.text
    if text == "star":
        reply = (
            "اضغط على الأوامر الموجودة في القائمة (قائمة في يمين البوت) أدناه لتحصل على كل ما تحتاجه:\n\n"
            "🎯 نأمل أن تنال خدمتنا رضاكم وأن نكون عند حسن ظنكم…"
        )
    elif text == "help":
        reply = "فيديو #شــــــرح_استخدام_البوت سيتوفر قريبا"
    bot.send_message(chat_id, reply, parse_mode="HTML", reply_markup=get_main_keyboard()) # إرجاع لوحة المفاتيح الرئيسية

# --- معالج عام لجميع أنواع الرسائل (نص، صور، مستندات) ---
# يجب أن يكون هذا المعالج في النهاية لكي لا يتعارض مع الأوامر الأخرى مثل /start
@bot.message_handler(func=lambda m: True, content_types=['text', 'photo', 'document'])
def handle_all_messages(message):
    chat_id = message.chat.id
    user_text = message.text # النص المرفق مع الرسالة أو نص الرسالة نفسها
    current_state = user_states.get(chat_id, "main_menu") # الحصول على حالة المستخدم الحالية

    # --- معالجة وضع الدردشة مع الذكاء الاصطناعي ---
    if current_state == "ai_chat_active":
        if message.text == "🔙 رجوع":
            user_states[chat_id] = "main_menu"
            bot.send_message(chat_id, "تم الخروج من وضع الدردشة مع الذكاء الاصطناعي. أهلاً بك في القائمة الرئيسية.", reply_markup=get_main_keyboard())
            return

        bot.send_chat_action(chat_id, 'typing') # إظهار حالة "يكتب..." للمستخدم

        prompt_parts = []
        # إضافة النص إذا كان موجوداً في الرسالة
        if message.text and message.text != "🤖 اسأل الذكاء الاصطناعي": # تجنب إضافة اسم الزر نفسه كمطالبة
            prompt_parts.append({"text": message.text})

        # معالجة الصور
        if message.photo:
            # الحصول على أكبر صورة (عادةً آخر عنصر في القائمة)
            file_id = message.photo[-1].file_id
            try:
                # تنزيل الصورة
                file_info = bot.get_file(file_id)
                downloaded_file = bot.download_file(file_info.file_path)

                # تحويل الصورة إلى Base64
                # تحديد نوع MIME بناءً على امتداد الملف (افتراضياً JPEG هنا)
                mime_type = "image/jpeg"
                if file_info.file_path.lower().endswith(".png"):
                    mime_type = "image/png"
                elif file_info.file_path.lower().endswith(".gif"):
                    mime_type = "image/gif" # إذا كنت تدعم GIF

                encoded_image = base64.b64encode(downloaded_file).decode('utf-8')

                # إضافة الصورة إلى أجزاء المطالبة
                prompt_parts.append({
                    "inlineData": {
                        "mimeType": mime_type,
                        "data": encoded_image
                    }
                })
                # يمكن إضافة نص توضيحي للصورة هنا إذا لم يكن هناك نص في الرسالة
                if not message.text:
                    prompt_parts.append({"text": "ماذا يوجد في هذه الصورة؟"}) # مطالبة افتراضية للصورة
            except Exception as e:
                print(f"ERROR: Failed to process photo: {e}")
                bot.send_message(chat_id, f"عذراً، حدث خطأ أثناء معالجة الصورة: {e}", reply_markup=create_keyboard(bot_content["🤖 اسأل الذكاء الاصطناعي"]["options"]))
                return
        
        # معالجة المستندات (الملفات الأخرى)
        elif message.document:
            # للتبسيط، لن نعالج المستندات (غير الصور) بـ Gemini مباشرة هنا
            # لأنها تتطلب مكتبات إضافية لاستخراج المحتوى (مثل PyPDF2 لـ PDF)
            bot.send_message(chat_id, "عذراً، لا أستطيع معالجة المستندات (مثل PDF أو Word) بواسطة الذكاء الاصطناعي حالياً. يمكنني فقط فهم النصوص والصور.", reply_markup=create_keyboard(bot_content["🤖 اسأل الذكاء الاصطناعي"]["options"]))
            return

        # إذا لم يكن هناك نص أو صورة صالحة للمعالجة بواسطة الذكاء الاصطناعي
        if not prompt_parts:
            bot.send_message(chat_id, "الرجاء إرسال نص أو صورة لأقوم بمعالجتها.", reply_markup=create_keyboard(bot_content["🤖 اسأل الذكاء الاصطناعي"]["options"]))
            return

        try:
            # استدعاء Gemini API مع الأجزاء (نص وصورة)
            ai_response = get_gemini_multimodal_response(prompt_parts)
            bot.send_message(chat_id, ai_response, parse_mode="HTML", reply_markup=create_keyboard(bot_content["🤖 اسأل الذكاء الاصطناعي"]["options"]))
        except requests.exceptions.RequestException as e:
            print(f"ERROR: Gemini API request failed: {e}")
            bot.send_message(chat_id, f"عذراً، حدث خطأ أثناء التواصل مع الذكاء الاصطناعي: {e}", reply_markup=create_keyboard(bot_content["🤖 اسأل الذكاء الاصطناعي"]["options"]))
        except Exception as e:
            print(f"ERROR: Unexpected error in AI chat: {e}")
            bot.send_message(chat_id, "عذراً، حدث خطأ غير متوقع أثناء معالجة طلبك.", reply_markup=create_keyboard(bot_content["🤖 اسأل الذكاء الاصطناعي"]["options"]))
        return # مهم: الخروج بعد معالجة الدردشة مع الذكاء الاصطناعي

    # --- معالجة القوائم العادية إذا لم يكن المستخدم في وضع الذكاء الاصطناعي ---
    # هذا الجزء هو نفسه الذي لديك حالياً لمعالجة الأزرار والقوائم
    reply_text = "عذراً، لم أفهم طلبك. الرجاء استخدام الأزرار."
    reply_markup = get_main_keyboard()

    if user_text == "🔙 رجوع":
        # التعامل مع زر الرجوع
        if current_state.startswith("حضوري_sub_sub_menu_"):
            user_states[chat_id] = "حضوري_sub_menu"
            reply_text = bot_content["تخصصات برامج الدبلوم - حضوري"]["menu_text"]
            reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - حضوري"]["options"])
        elif current_state == "حضوري_sub_menu":
            user_states[chat_id] = "main_menu"
            reply_text = "تم الرجوع إلى القائمة الرئيسية."
            reply_markup = get_main_keyboard()
        elif current_state.startswith("عن_بعد_sub_sub_menu_"):
            user_states[chat_id] = "عن_بعد_sub_menu"
            reply_text = bot_content["تخصصات برامج الدبلوم - عن بُعد"]["menu_text"]
            reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - عن بُعد"]["options"])
        elif current_state == "عن_بعد_sub_menu":
            user_states[chat_id] = "main_menu"
            reply_text = "تم الرجوع إلى القائمة الرئيسية."
            reply_markup = get_main_keyboard()
        elif current_state.startswith("books_sub_menu_"):
            parent_menu_key = current_state.replace("books_sub_menu_", "")
            user_states[chat_id] = "books_menu"
            reply_text = bot_content["كتب وملخصات مواد الدبلوم"]["menu_text"]
            reply_markup = create_keyboard(bot_content["كتب وملخصات مواد الدبلوم"]["options"])
        elif current_state == "books_menu":
            user_states[chat_id] = "main_menu"
            reply_text = "تم الرجوع إلى القائمة الرئيسية."
            reply_markup = get_main_keyboard()
        else:
            user_states[chat_id] = "main_menu"
            reply_text = "أنت بالفعل في القائمة الرئيسية."
            reply_markup = get_main_keyboard()
    elif current_state == "main_menu":
        # معالجة التبويبات الرئيسية
        if user_text == "🤖 اسأل الذكاء الاصطناعي":
            user_states[chat_id] = "ai_chat_active"
            reply_text = bot_content["🤖 اسأل الذكاء الاصطناعي"]["menu_text"]
            reply_markup = create_keyboard(bot_content["🤖 اسأل الذكاء الاصطناعي"]["options"])
        elif user_text in bot_content:
            content_item = bot_content[user_text]
            if isinstance(content_item, dict) and "options" in content_item:
                reply_text = content_item["menu_text"]
                reply_markup = create_keyboard(content_item["options"])
                if user_text == "تخصصات برامج الدبلوم - حضوري":
                    user_states[chat_id] = "حضوري_sub_menu"
                elif user_text == "تخصصات برامج الدبلوم - عن بُعد":
                    user_states[chat_id] = "عن_بعد_sub_menu"
                elif user_text == "كتب وملخصات مواد الدبلوم":
                    user_states[chat_id] = "books_menu"
            else:
                reply_text = content_item
                reply_markup = get_main_keyboard()
        else:
            reply_text = "عذراً، هذا التبويب غير موجود. الرجاء استخدام الأزرار."
            reply_markup = get_main_keyboard()
    elif current_state == "حضوري_sub_menu":
        if user_text in bot_content["تخصصات برامج الدبلوم - حضوري"]:
            content_item = bot_content["تخصصات برامج الدبلوم - حضوري"][user_text]
            if isinstance(content_item, dict) and "options" in content_item:
                reply_text = content_item["menu_text"]
                reply_markup = create_keyboard(content_item["options"])
                user_states[chat_id] = f"حضوري_sub_sub_menu_{user_text}"
            else:
                reply_text = content_item
                reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - حضوري"]["options"])
        else:
            reply_text = "عذراً، هذا التخصص غير موجود في قائمة الدبلوم الحضوري. الرجاء استخدام الأزرار."
            reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - حضوري"]["options"])
    elif current_state.startswith("حضوري_sub_sub_menu_"):
        parent_menu_key = current_state.replace("حضوري_sub_sub_menu_", "")
        if parent_menu_key in bot_content["تخصصات برامج الدبلوم - حضوري"] and \
           isinstance(bot_content["تخصصات برامج الدبلوم - حضوري"][parent_menu_key], dict) and \
           user_text in bot_content["تخصصات برامج الدبلوم - حضوري"][parent_menu_key]:
            content_item = bot_content["تخصصات برامج الدبلوم - حضوري"][parent_menu_key][user_text]
            reply_text = content_item
            reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - حضوري"][parent_menu_key]["options"])
        else:
            reply_text = "عذراً، هذا الخيار غير موجود. الرجاء استخدام الأزرار."
            if parent_menu_key in bot_content["تخصصات برامج الدبلوم - حضوري"] and \
               isinstance(bot_content["تخصصات برامج الدبلوم - حضوري"][parent_menu_key], dict):
                reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - حضوري"][parent_menu_key]["options"])
            else:
                reply_markup = get_main_keyboard()
                user_states[chat_id] = "main_menu"
    elif current_state == "عن_بعد_sub_menu":
        if user_text in bot_content["تخصصات برامج الدبلوم - عن بُعد"]:
            content_item = bot_content["تخصصات برامج الدبلوم - عن بُعد"][user_text]
            if isinstance(content_item, dict) and "options" in content_item:
                reply_text = content_item["menu_text"]
                reply_markup = create_keyboard(content_item["options"])
                user_states[chat_id] = f"عن_بعد_sub_sub_menu_{user_text}"
            else:
                reply_text = content_item
                reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - عن بُعد"]["options"])
        else:
            reply_text = "عذراً، هذا الخيار غير موجود في قائمة الدبلوم عن بُعد. الرجاء استخدام الأزرار."
            reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - عن بُعد"]["options"])
    elif current_state.startswith("عن_بعد_sub_sub_menu_"):
        parent_menu_key = current_state.replace("عن_بعد_sub_sub_menu_", "")
        if parent_menu_key in bot_content["تخصصات برامج الدبلوم - عن بُعد"] and \
           isinstance(bot_content["تخصصات برامج الدبلوم - عن بُعد"][parent_menu_key], dict) and \
           user_text in bot_content["تخصصات برامج الدبلوم - عن بُعد"][parent_menu_key]:
            content_item = bot_content["تخصصات برامج الدبلوم - عن بُعد"][parent_menu_key][user_text]
            reply_text = content_item
            reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - عن بُعد"][parent_menu_key]["options"])
        else:
            reply_text = "عذراً، هذا الخيار غير موجود. الرجاء استخدام الأزرار."
            if parent_menu_key in bot_content["تخصصات برامج الدبلوم - عن بُعد"] and \
               isinstance(bot_content["تخصصات برامج الدبلوم - عن بُعد"][parent_menu_key], dict):
                reply_markup = create_keyboard(bot_content["تخصصات برامج الدبلوم - عن بُعد"][parent_menu_key]["options"])
            else:
                reply_markup = get_main_keyboard()
                user_states[chat_id] = "main_menu"
    elif current_state == "books_menu":
        # معالجة القائمة الفرعية لـ "كتب وملخصات مواد الدبلوم"
        if user_text in bot_content["كتب وملخصات مواد الدبلوم"]:
            content_item = bot_content["كتب وملخصات مواد الدبلوم"][user_text]
            if isinstance(content_item, dict) and "content" in content_item:
                reply_text = content_item["menu_text"] + "\n\n" + content_item["content"]
                reply_markup = create_keyboard(content_item["options"])
                user_states[chat_id] = f"books_sub_menu_{user_text}"
        else:
            reply_text = "عذراً، هذا الخيار غير موجود. الرجاء استخدام الأزرار."
            reply_markup = create_keyboard(bot_content["كتب وملخصات مواد الدبلوم"]["options"])
    elif current_state.startswith("books_sub_menu_"):
        # التعامل مع القائمة الفرعية الداخلية لـ "كتب وملخصات مواد الدبلوم"
        parent_menu_key = current_state.replace("books_sub_menu_", "")
        if parent_menu_key in bot_content["كتب وملخصات مواد الدبلوم"] and user_text == "🔙 رجوع":
            user_states[chat_id] = "books_menu"
            reply_text = bot_content["كتب وملخصات مواد الدبلوم"]["menu_text"]
            reply_markup = create_keyboard(bot_content["كتب وملخصات مواد الدبلوم"]["options"])
        else:
            reply_text = "عذراً، هذا الخيار غير موجود. الرجاء استخدام الأزرار."
            reply_markup = create_keyboard(bot_content["كتب وملخصات مواد الدبلوم"][parent_menu_key]["options"])

    # إضافة طباعة لتصحيح الأخطاء (ستظهر في سجلات Render)
    print(f"DEBUG: Sending message to {chat_id}. Current state: {current_state}. User text: {user_text}")
    print(f"DEBUG: Reply text length: {len(reply_text)}. Reply text starts with: {reply_text[:100].replace('\n', ' ')}")
    try:
        # استخدام parse_mode="HTML" لضمان عرض المحتوى بشكل صحيح
        bot.send_message(chat_id, reply_text, parse_mode="HTML", reply_markup=reply_markup)
    except telebot.apihelper.ApiTelegramException as e:
        print(f"ERROR: Failed to send message to {chat_id}: {e}")
        # إرسال رسالة خطأ للمستخدم بدلاً من الفشل الصامت
        bot.send_message(chat_id, "عذراً، حدث خطأ أثناء عرض المحتوى. الرجاء المحاولة لاحقاً.", parse_mode="HTML", reply_markup=reply_markup)


# --- Webhook endpoint for Flask ---
@app.route('/' + TOKEN, methods=['POST'])
def getMessage():
    # استلام بيانات الـ Webhook من تليجرام
    json_str = request.get_data().decode('UTF-8')
    # تحويل بيانات JSON إلى كائن Update
    update = telebot.types.Update.de_json(json_str)
    # معالجة التحديثات الجديدة بواسطة البوت
    bot.process_new_updates([update])
    # إرجاع استجابة 200 OK لتليجرام
    return "!", 200

@app.route('/')
def webhook():
    # هذا المسار يستخدم لفحص حالة الخدمة (Health Check)
    # لا داعي لإعادة تعيين الـ Webhook هنا لتجنب تجاوز حدود المعدل
    return "Bot is running", 200

if __name__ == '__main__':
    # عند بدء تشغيل التطبيق، نقوم بتعيين الـ Webhook مرة واحدة فقط
    try:
        bot.remove_webhook()
        bot.set_webhook(url=RENDER_WEBHOOK_URL)
        print(f"✅ تم تعيين الويب هوك بنجاح إلى: {RENDER_WEBHOOK_URL}")
    except Exception as e:
        print(f"❌ حدث خطأ أثناء تعيين الويب هوك: {e}")

    # تشغيل تطبيق Flask.
    # '0.0.0.0' يجعل التطبيق متاحًا من أي عنوان IP خارجي.
    # 'PORT' يتم جلبه من متغيرات البيئة (عادةً 5000 على Render).
    app.run(host="0.0.0.0", port=int(os.environ.get('PORT', 5000)))
