import os
from flask import Flask, request
import telebot
from telebot import types
import requests
import json
import base64 # تم إضافة هذه المكتبة لتحويل الصور إلى Base64

# --- إعدادات البوت والـ API ---

# يتم جلب التوكن من متغيرات البيئة.
# تأكد من أن متغير البيئة TELEGRAM_TOKEN مضبوط بشكل صحيح في إعدادات Render.
TOKEN = os.getenv("TELEGRAM_TOKEN")
if not TOKEN:
    raise ValueError("⚠️ متغير البيئة TELEGRAM_TOKEN غير موجود. الرجاء إضافته في إعدادات Render.")

# تهيئة كائن البوت باستخدام التوكن
bot = telebot.TeleBot(TOKEN)
# تهيئة تطبيق Flask
app = Flask(__name__)

# عنوان URL لخدمة Render الخاصة بك.
# RENDER_EXTERNAL_URL هو متغير بيئة يتم توفيره بواسطة Render ويحتوي على URL الأساسي لتطبيقك.
RENDER_EXTERNAL_URL_BASE = os.getenv("RENDER_EXTERNAL_URL")
if RENDER_EXTERNAL_URL_BASE:
    # تأكد من أن URL ينتهي بشرطة مائلة
    if not RENDER_EXTERNAL_URL_BASE.endswith('/'):
        RENDER_EXTERNAL_URL_BASE += '/'
    RENDER_WEBHOOK_URL = RENDER_EXTERNAL_URL_BASE + TOKEN
else:
    # يجب استبدال هذا بـ URL الخاص بتطبيقك المنشور إذا كنت لا تستخدم Render أو لم يتم تعيين المتغير.
    # مثال: "https://your-app-name.onrender.com/" + TOKEN
    RENDER_WEBHOOK_URL = "https://your-deployed-app-url.com/" + TOKEN
    print("⚠️ لم يتم العثور على متغير بيئة RENDER_EXTERNAL_URL. يرجى تحديث RENDER_WEBHOOK_URL يدوياً.")

# إعدادات واجهة برمجة تطبيقات Gemini (نموذج gemini-2.0-flash).
# تحذير: هذه الممارسة لا يُنصح بها لأسباب أمنية في بيئات الإنتاج.
GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent"
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")

# --- القنوات المطلوبة للاشتراك ---
REQUIRED_CHANNELS = [
    {'id': '@KSDN_222', 'url': 'https://t.me/KSDN_222'},
    {'id': '@KDiplomasSU', 'url': 'https://t.me/KDiplomasSU'},
    {'id': '@Diploma_Solutions', 'url': 'https://t.me/Diploma_Solutions'},
]

# --- لوحة المفاتيح الرئيسية ---
main_keyboard_layout = [
    ["تقويم عام 1447ه‍.", "خدمات التواصل مع الجامعة"],
    ["الاسئلة الشائعة_عام", "تخصصات برامج الدبلوم - حضوري"],
    ["تخصصات برامج الدبلوم - عن بُعد", "قروبات التخصص"],
    ["قروبات المواد للمستجدين", "كتب وملخصات مواد الدبلوم"],
    ["قناة وإعلانات الدبلوم 📢", "خدمات حل الواجبات وعمل المشاريع والبحوث"],
    ["مواقع فروع جامعة الملك سعود", "شروط التجسير في جامعة الملك سعود"],
    ["🛑شرح استخدام – البلاك بورد / Blackboard 🛑", "🤖 اسأل الذكاء الاصطناعي"]
]

# قاموس لتخزين حالة القائمة الحالية لكل مستخدم
user_states = {} # {chat_id: current_menu_key}

# --- وظيفة للحصول على استجابة من Gemini API (متعدد الوسائط) ---
def get_gemini_multimodal_response(parts):
    """
    يرسل مطالبة متعددة الوسائط (نص وصور) إلى Gemini API ويعيد النص الذي تم إنشاؤه.
    """
    if not GEMINI_API_KEY:
        return "عذراً، لا يمكنني التواصل مع الذكاء الاصطناعي حالياً. مفتاح الـ API غير متوفر."

    payload = {
        "contents": [
            {
                "role": "user",
                "parts": parts
            }
        ]
    }
    headers = {'Content-Type': 'application/json'}
    params = {'key': GEMINI_API_KEY}

    try:
        response = requests.post(GEMINI_API_URL, headers=headers, params=params, data=json.dumps(payload))
        response.raise_for_status()
        result = response.json()
        if result.get("candidates") and result["candidates"][0].get("content") and result["candidates"][0]["content"].get("parts"):
            return result["candidates"][0]["content"]["parts"][0]["text"]
        else:
            print(f"ERROR: Unexpected Gemini API response structure: {result}")
            return "عذراً، لم أتمكن من الحصول على إجابة واضحة من الذكاء الاصطناعي."
    except requests.exceptions.RequestException as e:
        print(f"ERROR: Gemini API request failed: {e}")
        return "عذراً، حدث خطأ أثناء الاتصال بخدمة الذكاء الاصطناعي."

# قاموس شامل لتخزين جميع محتويات البوت، بما في ذلك النصوص والقوائم الفرعية
bot_content = {
    # تم تحديث النص الخاص بـ 'تقويم عام 1447ه‍.' بالرسالة الجديدة المنسقة
    "تقويم عام 1447ه‍.": "🔹 **التقويم الأكاديمي لـ #جامعة_الملك_سعود للعام الدراسي 2025 / 2026م (1447هـ):**\n\n[اضغط هنا لمشاهدة التقويم الأكاديمي 👇](https://t.me/KSDN_222/85)",
    "خدمات التواصل مع الجامعة": """عمادة السنة الأولى المشتركة
SSHELP@CFY.KSU.EDU.SA
00966-114694006

الشؤون الطلابية
ksugcc@ksu.edu.sa
00966 1 8050141

المشرف على وحدة التوجيه و الإرشاد الطلابي
sg@cfy.ksu.edu.sa
4694118
رقم المكتب: 2484

المشرف على وحدة شؤون الطلاب
sa@cfy.ksu.edu.sa

ايميلات عمادة القبول والتسجيل
dar@ksu.edu.sa
darweb@ksu.edu.sa

ارقام عمادة القبول والتسجيل
0114677722
0118054402

منسق/ة الفيزياء
nbennessib@ksu.edu.sa
nalkathran@ksu.edu.sa

منسق احياء
aalii@ksu.edu.sa
somer@ksu.edu.sa

منسق كيم
amenizi@ksu.edu.sa
zalmarhoon@ksu.edu.sa

منسق/ة انجل
mramadan@cfy.ksu.edu.sa
h.alshareef@cfy.ksu.edu.sa

فرع عليشه ( بنات)
011 805 7331

فرع الناصريه( الوشم بمسمى اخر)
0114036600""",
    "الاسئلة الشائعة_عام": """<b>● الأسئلة الشائعة - عام</b>
◇ الأسئلة الشائعة حول القبول: <a href="https://dar.ksu.edu.sa/ar/FAQ">اضغط هنا</a>
◇ الأسئلة الشائعة للطلاب المنتظمين: <a href="https://dar.ksu.edu.sa/ar/faqs">اضغط هنا</a>
◇ الأسئلة الشائعة للطلاب الخريجين: <a href="https://dar.ksu.edu.sa/ar/gfaq">اضغط هنا</a>""",
    "تخصصات برامج الدبلوم - حضوري": {
        "menu_text": "الرجاء اختيار تخصص الدبلوم الحضوري:",
        "options": [
            "دبلوم محاسبة",
            "دبلوم التسويق",
            "دبلوم الأنظمة",
            "دبلوم البرمجة وقواعد البيانات",
            "دبلوم السكرتارية الطبية",
            "دبلوم الاعمال المصرفية",
            "دبلوم الوسائط المتعددة التفاعلية",
            "دبلوم الامن السيبراني",
            "دبلوم السكرتارية التنفيذية",
            "دبلوم تقنية النظارات",
            "دبلوم إدارة الموارد البشرية",
            "دبلوم المحاسبة الضريبية",
            "دبلوم الترجمة بلغة الإشارة",
            "دبلوم مقدمي الرعاية بالحضانات",
            "دبلوم اللغة الصينية",
            "الدبلوم المشارك في العمل الخيري",
            "🔙 رجوع"
        ],
        "دبلوم محاسبة": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في المحاسبة – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تلبية متطلبات سوق العمل السعودي من الكوادر المؤهلة في المحاسبة، من خلال إعداد خريجين يمتلكون المعارف والمهارات اللازمة لأداء المهام المحاسبية بكفاءة.
\n<b>🎯 الأهداف الرئيسة:</b>
• توفير بيئة أكاديمية متطورة لإعداد كوادر متميزة.
• تأهيل الطلبة بأحدث المفاهيم والمعارف النظرية والتطبيقية.
• تنمية المهارات الفكرية والبحثية للعمل بكفاءة عالية.
• تطوير المهارات العملية لإنجاز الأنشطة المحاسبية.
• تدريب الطلاب على استخدام الحاسب الآلي والتطبيقات المحاسبية الحديثة.
• تقديم مرجعية علمية تجمع بين الجانب النظري والتطبيقي.
\n\n<b>💼 الفرص الوظيفية:</b>
• مساعد محاسب، محصل إيرادات، مأمور مبيعات، أمين صندوق، مأمور عهد، مراقب عهد، مراقب مخازن، أمين مستودع، مفتش تموين، مأمور مشتريات، مراقب تجاري، مساعد مدقق حسابات، كاتب إداري في الإدارة المالية، مساعد مدرب في مجال التخصص.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في المحاسبة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في المحاسبة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_lmqrrt_ldblwm_lmhsb.pdf\">عرض الوصف</a>"
        },
        "دبلوم التسويق": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في التسويق – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر مهنية متمكنة للعمل بكفاءة عالية في الوظائف المتخصصة في قطاعات الأعمال بالمملكة، بتزويدهم بالمعارف والمهارات العملية التسويقية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل الطلاب نظريًا وعمليًا في التسويق الحديث.
• تدريب الطلاب على التطبيقات العملية.
• تمكين الطلاب من استخدام تقنيات المعلومات في اتخاذ القرارات التسويقية.
• تنمية قدرة الطلاب على التعامل مع المشكلات التسويقية.
• إعداد الطلاب للتفاعل الفعال مع التحديات المستقبلية.
\n\n<b>📘 المخرجات المعرفية:</b>
• فهم عميق للمفاهيم والمبادئ والتقنيات التسويقية.
• التعرّف على القضايا والاتجاهات الحالية في بيئة التسويق.
• فهم أدوات وتقنيات التسويق من منظور داخلي وخارجي.
• التمكن من استخدام التكنولوجيات الحديثة في التعامل مع العملاء.
• الإلمام بالأساليب والمنهجيات المستخدمة في البحوث التسويقية.
\n\n<b>🛠 المخرجات المهارية:</b>
• القدرة على العمل ضمن فرق أو بشكل فردي.
• إدراك الجوانب الأخلاقية المتعلقة بمهنة التسويق.
• التواصل الفعال كتابيًا وشفويًا باستخدام الوسائل الرقمية.
• توظيف المهارات العددية والتحليلية في حل المشكلات.
\n\n<b>💼 الفرص الوظيفية:</b>
• مأمور مبيعات، مساعد مدرب (في مجال التخصص)، مدقق مشتريات مساعد، محصل إيرادات، مأمور مشتريات، مراقب تجاري، كاتب في إدارة التسويق.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في التسويق (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D8%AA%D8%B3%D9%88%D9%8A%D9%82_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في التسوق: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/imce_images/2_4.pdf\">عرض الوصف</a>"
        },
        "دبلوم الأنظمة": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الأنظمة – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر قانونية مؤهلة للعمل بكفاءة في القطاعات الإدارية والاستثمارية، والمساهمة في تطوير المنظومة القانونية بما يتوافق مع رؤية 2030.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل كفاءات قانونية قادرة على المنافسة في سوق العمل.
• دعم تطوير وتفعيل الأنظمة القانونية الحديثة.
• تعزيز الثقافة القانونية ونشر الوعي.
• تطوير التدريب الميداني للطلاب.
• توظيف الخبرات لتطوير البحث العلمي وجودة التعليم.
\n\n<b>💼 الفرص الوظيفية:</b>
<b>أولاً – في القطاع التجاري والاستثماري:</b>
• مراقب تجاري، مراقب جمركي، مدقق جمركي، مدقق طلبات، مراجع قانوني.
<b>ثانيًا – في القطاع الإداري والعدلي:</b>
• مساعد إداري، مساعد محامٍ، كاتب عدل، كاتب ضبط، مدقق قانوني، مدخل بيانات قانونية.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الأنظمة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في الأنظمة: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/imce_images/2_2.pdf\">عرض الوصف</a>"
        },
        "دبلوم البرمجة وقواعد البيانات": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في برمجة وقواعد البيانات – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر فنية متخصصة ومؤهلة في مجالي البرمجة وقواعد البيانات، لتلبية احتياجات سوق العمل من خلال التدريب العملي والمعرفة التقنية الحديثة.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تخريج فنيين متخصصين في تصميم نظم البرمجة وقواعد البيانات.
• تدريب الطلاب على أحدث أساليب وتقنيات البرمجة.
• تعريف الطلاب بمفاهيم تحليل وتصميم النظم.
• إكساب الدارسين مهارات تصميم وصيانة قواعد البيانات.
• تأهيل الطلاب لفهم نظم التشغيل الحديثة.
\n\n<b>💼 الفرص الوظيفية:</b>
• مساعد مبرمج، مشغّل أجهزة حاسب آلي، فني مواصفات ومقاييس، مساعد مدرب (في مجال التخصص).
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في البرمجة وقواعد البيانات (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في البرمجة وقواعد البيانات: <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/twsyf_lmqrrt_lbrnmj_ldblwm_fy_lbrmj_wqwd_lbynt.pdf\">عرض الوصف</a>"
        },
        "دبلوم السكرتارية الطبية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في السكرتارية الطبية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تأهيل كوادر وطنية متخصصة في السكرتارية الطبية، للعمل بكفاءة واحترافية في المنشآت الصحية وتلبية احتياجات سوق العمل.
\n<b>🎯 الأهداف الرئيسة:</b>
• إعداد كوادر مؤهلة للعمل في السكرتارية الطبية.
• إكساب الطلاب المهارات الإدارية والفنية الأساسية.
• تنمية السلوكيات المهنية ومهارات التواصل.
• الإلمام بالنظام الصحي السعودي وكيفية التعامل مع التأمين.
• تدريب الطلاب على المهام المكتبية باستخدام التقنيات الحديثة.
• تعزيز مهارات اللغة الإنجليزية الطبية.
\n\n<b>💼 الفرص الوظيفية:</b>
• مصنّف من <b>وزارة الخدمة المدنية</b> ومعتمد من <b>هيئة التخصصات الصحية</b>.
• التعيين على <b>كادر الوظائف الصحية – المرتبة السادسة</b>.
• سكرتير طبي في المستشفيات (الحكومية والخاصة).
• فني سجلات طبية في القطاعات الصحية.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في السكرتارية الطبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9_%D8%A7%D9%84%D9%85%D8%AA%D9%88%D8%B3%D8%B7%D8%A9_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في السكرتارية الطبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_dblwm_lskrtry_ltby.pdf\">عرض الوصف</a>"
        },
        "دبلوم الاعمال المصرفية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الأعمال المصرفية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد متخصصين ومحترفين في الأعمال المصرفية، قادرين على أداء المهام الإدارية والفنية بكفاءة في القطاعات المالية والمصرفية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تزويد الطلاب بالمعارف النظرية والتطبيقية في العلوم المصرفية.
• تأهيل كوادر وطنية متخصصة للعمل في المؤسسات المالية.
• تطوير المهارات الفنية والإدارية للطلاب.
• تعزيز المهارات الرقمية والمهنية.
\n\n<b>💼 الفرص الوظيفية:</b>
• أمين صندوق، أمين مستودع، محصل إيرادات، مأمور صرف، مأمور مشتريات، مساعد مدرب (في مجال التخصص).
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الأعمال المصرفية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/twsyf_lmqrrt_lbrnmj_ldblwm_fy_lmal_lmsrfy.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في الأعمال المصرفية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_lshwn_ldry_wml.pdf\">عرض الوصف</a>"
        },
        "دبلوم الوسائط المتعددة التفاعلية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الوسائط المتعددة التفاعلية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تزويد سوق العمل بكوادر وطنية متخصصة في مجالات الوسائط المتعددة، بما يخدم رؤية المملكة 2030 في التحول الرقمي.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• إعداد كوادر مؤهلة في التصميم الرقمي وتقنيات الوسائط.
• تمكين الطلاب من استخدام أدوات التصميم الجرافيكي الحديثة.
• تأهيل الطلاب لإنتاج المحتوى الرقمي وتطويره.
• تعزيز مهاراتهم في التصميم التفاعلي والمونتاج.
\n\n<b>💼 الفرص الوظيفية:</b>
• مصمم وسائط متعددة، مصمم جرافيكي، فني مونتاج، مصور رقمي، منتج محتوى رقمي.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الوسائط المتعددة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_lwsyt_ltdd_ltfyl.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في الوسائط المتعددة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_lwsyt_ltdd_ltfyl.pdf\">عرض الوصف</a>"
        },
        "دبلوم الامن السيبراني": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الأمن السيبراني – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تلبية احتياجات سوق العمل من متخصصين مؤهلين في مجال الأمن السيبراني، لحماية الأنظمة والبيانات من الهجمات السيبرانية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• إعداد كوادر متخصصة في حماية أمن المعلومات.
• تنمية قدرة الطلاب على تحليل المخاطر السيبرانية.
• تأهيل الطلاب للتعامل مع التهديدات الأمنية المختلفة.
• تدريب الطلاب على أحدث التقنيات في الأمن السيبراني.
\n\n<b>💼 الفرص الوظيفية:</b>
• فني أمن سيبراني، محلل أمن معلومات، مدقق أمن أنظمة.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الأمن السيبراني (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_lmn_lsybrny.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في الأمن السيبراني (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_lmn_lsybrny.pdf\">عرض الوصف</a>"
        },
        "دبلوم السكرتارية التنفيذية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في السكرتارية التنفيذية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد متخصصين في السكرتارية التنفيذية، لتزويد سوق العمل بكفاءات إدارية قادرة على أداء المهام المكتبية والإدارية بكفاءة عالية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل كوادر وطنية في مجال السكرتارية.
• تزويد الطلاب بالمهارات الإدارية والتنظيمية.
• تدريب الطلاب على استخدام التقنيات المكتبية الحديثة.
• تطوير مهارات التواصل والعلاقات العامة.
\n\n<b>💼 الفرص الوظيفية:</b>
• سكرتير تنفيذي، مساعد إداري، منسق إداري، كاتب إداري.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في السكرتارية التنفيذية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_dswm_lskrtry_ltnfydy.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في السكرتارية التنفيذية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_ldblwm_lskrtry_ltnfydy.pdf\">عرض الوصف</a>"
        },
        "دبلوم تقنية النظارات": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في تقنية النظارات – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد فنيي نظارات مؤهلين، قادرين على تقديم خدمات فنية وبصرية متخصصة في مجالات البصريات وتجهيز النظارات.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تزويد سوق العمل بمتخصصين في تقنية النظارات.
• تدريب الطلاب على أحدث التقنيات في البصريات.
• تأهيل الطلاب للتعامل مع العدسات والنظارات الطبية.
• تطوير المهارات الفنية والتقنية للطلاب.
\n\n<b>💼 الفرص الوظيفية:</b>
• فني بصريات، فني نظارات، فني تجهيز عدسات.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في تقنية النظارات (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_fy_tqny_lnzr.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في تقنية النظارات (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_ldblwm_fy_tqny_lnzr.pdf\">عرض الوصف</a>"
        },
        "دبلوم إدارة الموارد البشرية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في إدارة الموارد البشرية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تأهيل كوادر وطنية متخصصة في إدارة الموارد البشرية، لتلبية احتياجات سوق العمل من خلال تزويدهم بالمعارف والمهارات اللازمة لإدارة شؤون الموظفين.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• إعداد متخصصين في إدارة الموارد البشرية.
• تزويد الطلاب بالمعارف النظرية والتطبيقية.
• تطوير المهارات الإدارية والتنظيمية.
• تعزيز مهارات التوظيف والتدريب والتقييم.
\n\n<b>💼 الفرص الوظيفية:</b>
• مساعد مدير موارد بشرية، منسق موارد بشرية، كاتب شؤون موظفين.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في إدارة الموارد البشرية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_fy_dr_lwwrd_lbshr.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في إدارة الموارد البشرية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_dr_lwwrd_lbshr.pdf\">عرض الوصف</a>"
        },
        "دبلوم المحاسبة الضريبية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في المحاسبة الضريبية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد متخصصين في المحاسبة الضريبية، لتلبية حاجة سوق العمل من الكفاءات القادرة على التعامل مع الأنظمة الضريبية المختلفة، مثل ضريبة القيمة المضافة والضريبة الانتقائية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل كوادر متخصصة في المحاسبة الضريبية.
• تزويد الطلاب بالمعرفة النظرية والتطبيقية في أنظمة الضرائب.
• تطوير مهارات التعامل مع البرامج المحاسبية الضريبية.
• تعزيز القدرة على تحليل البيانات المالية لأغراض ضريبية.
\n\n<b>💼 الفرص الوظيفية:</b>
• مساعد محاسب ضريبي، مراجع ضريبي، مدقق ضرائب.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في المحاسبة الضريبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_lmhsb_lzryby.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في المحاسبة الضريبية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_lmhsb_lzryby.pdf\">عرض الوصف</a>"
        },
        "دبلوم الترجمة بلغة الإشارة": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في الترجمة بلغة الإشارة – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد مترجمين متخصصين في لغة الإشارة، لتمكين الصم وضعاف السمع من التواصل الفعال والمشاركة الكاملة في المجتمع.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل مترجمين محترفين في لغة الإشارة السعودية.
• تزويد الطلاب بالمهارات اللغوية والترجمية اللازمة.
• تعزيز فهم الطلاب لثقافة الصم واحتياجاتهم.
• تدريب الطلاب على الترجمة الفورية والتحريرية بلغة الإشارة.
\n\n<b>💼 الفرص الوظيفية:</b>
• مترجم لغة إشارة في الجهات الحكومية والخاصة.
• معلم لغة إشارة، منسق دعم للصم.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الترجمة بلغة الإشارة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_ltrjm_blgh_lsh_0.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في الترجمة بلغة الإشارة (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_ldblwm_ltrjm_blgh_lsh.pdf\">عرض الوصف</a>"
        },
        "دبلوم مقدمي الرعاية بالحضانات": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في مقدمي الرعاية بالحضانات – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر نسائية مؤهلة للعمل في الحضانات ورياض الأطفال، لتوفير بيئة آمنة ومحفزة لنمو الأطفال في سنواتهم الأولى.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل كوادر متخصصة في رعاية الأطفال.
• تزويد الطلاب بالمعرفة النظرية والمهارات العملية في تنمية الطفل.
• تعزيز مهارات التعامل مع احتياجات الأطفال المختلفة.
• تدريب الطلاب على تقديم الرعاية الصحية والنفسية للأطفال.
\n\n<b>💼 الفرص الوظيفية:</b>
• مقدمة رعاية في الحضانات، مساعدة معلمة في رياض الأطفال.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في مقدمي الرعاية بالحضانات (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_mqdmy_lry.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في مقدمي الرعاية بالحضانات (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_ldblwm_mqdmy_lry.pdf\">عرض الوصف</a>"
        },
        "دبلوم اللغة الصينية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في اللغة الصينية – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر متخصصة في اللغة الصينية، لتلبية احتياجات سوق العمل السعودي من المترجمين والمتخصصين في التعامل مع الثقافة الصينية، بما يتوافق مع التوجهات الاقتصادية للمملكة.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• إتقان اللغة الصينية تحدثًا وكتابةً.
• تأهيل الطلاب للتعامل مع النصوص الصينية المختلفة.
• فهم الثقافة الصينية وتاريخها.
• تدريب الطلاب على الترجمة التحريرية والشفوية من وإلى الصينية.
\n\n<b>💼 الفرص الوظيفية:</b>
• مترجم لغة صينية، مرشد سياحي، منسق علاقات تجارية.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في اللغة الصينية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_llgh_lsyny.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في اللغة الصينية (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_ldblwm_llgh_lsyny.pdf\">عرض الوصف</a>"
        },
        "الدبلوم المشارك في العمل الخيري": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المشارك في العمل الخيري – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر متخصصة في مجال العمل الخيري والقطاع غير الربحي، لتلبية احتياجات هذا القطاع من خلال تزويدهم بالمعارف والمهارات اللازمة لإدارة وتنظيم الأنشطة الخيرية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل كوادر متخصصة في العمل الخيري.
• تزويد الطلاب بالمعرفة النظرية والتطبيقية.
• تطوير المهارات الإدارية والتنظيمية للطلاب.
• تعزيز مهارات جمع التبرعات وإدارة المشاريع الخيرية.
\n\n<b>💼 الفرص الوظيفية:</b>
• منسق مشاريع خيرية، باحث اجتماعي، مسؤول علاقات عامة في الجمعيات الخيرية.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المشارك في العمل الخيري (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/khth_drsy_ldblwm_lmshrk_fy_lml_lkhyry.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المشارك في العمل الخيري (الجديدة): <a href=\"https://ascs.ksu.edu.sa/sites/ascs.ksu.edu.sa/files/attach/wsf_mqrrt_lsh_ldblwm_lmshrk_fy_lml_lkhyry_0.pdf\">عرض الوصف</a>"
        },
    },
    "تخصصات برامج الدبلوم - عن بُعد": {
        "menu_text": "الرجاء اختيار تخصص الدبلوم عن بُعد:",
        "options": [
            "دبلوم إدارة أعمال",
            "دبلوم التسويق",
            "دبلوم الموارد البشرية",
            "دبلوم المصرفية الإسلامية",
            "🔙 رجوع"
        ],
        "دبلوم إدارة أعمال": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في إدارة الأعمال – جامعة الملك سعود</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد متخصصين في إدارة الأعمال، لتلبية احتياجات سوق العمل من الكفاءات القادرة على أداء المهام الإدارية والتنظيمية بكفاءة في مختلف قطاعات الأعمال.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل كوادر وطنية في مجال إدارة الأعمال.
• تزويد الطلاب بالمعارف النظرية والتطبيقية في الإدارة.
• تطوير المهارات الإدارية والتنظيمية للطلاب.
• تعزيز مهارات اتخاذ القرار وحل المشكلات.
\n\n<b>💼 الفرص الوظيفية:</b>
• مساعد مدير إداري، منسق إداري، كاتب إداري.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في إدارة الأعمال (عن بعد): <a href=\"https://elearning.ksu.edu.sa/elearning/assets/uploads/files/DIPLOMA-BA.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في إدارة الأعمال (عن بعد): <a href=\"https://elearning.ksu.edu.sa/elearning/assets/uploads/files/Course-Description-BA.pdf\">عرض الوصف</a>"
        },
        "دبلوم التسويق": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في التسويق – جامعة الملك سعود (عن بعد)</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد كوادر مهنية متمكنة للعمل بكفاءة عالية في الوظائف المتخصصة في قطاعات الأعمال بالمملكة، بتزويدهم بالمعارف والمهارات العملية التسويقية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تأهيل الطلاب نظريًا وعمليًا في التسويق الحديث.
• تدريب الطلاب على التطبيقات العملية.
• تمكين الطلاب من استخدام تقنيات المعلومات في اتخاذ القرارات التسويقية.
• تنمية قدرة الطلاب على التعامل مع المشكلات التسويقية.
• إعداد الطلاب للتفاعل الفعال مع التحديات المستقبلية.
\n\n<b>💼 الفرص الوظيفية:</b>
• مأمور مبيعات، مساعد مدرب (في مجال التخصص)، مدقق مشتريات مساعد، محصل إيرادات، مأمور مشتريات، مراقب تجاري، كاتب في إدارة التسويق.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في التسويق (عن بعد): <a href=\"https://elearning.ksu.edu.sa/elearning/assets/uploads/files/DIPLOMA-M.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في التسويق (عن بعد): <a href=\"https://elearning.ksu.edu.sa/elearning/assets/uploads/files/Course-Description-M.pdf\">عرض الوصف</a>"
        },
        "دبلوم الموارد البشرية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في إدارة الموارد البشرية – جامعة الملك سعود (عن بعد)</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى تأهيل كوادر وطنية متخصصة في إدارة الموارد البشرية، لتلبية احتياجات سوق العمل من خلال تزويدهم بالمعارف والمهارات اللازمة لإدارة شؤون الموظفين.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• إعداد متخصصين في إدارة الموارد البشرية.
• تزويد الطلاب بالمعارف النظرية والتطبيقية.
• تطوير المهارات الإدارية والتنظيمية.
• تعزيز مهارات التوظيف والتدريب والتقييم.
\n\n<b>💼 الفرص الوظيفية:</b>
• مساعد مدير موارد بشرية، منسق موارد بشرية، كاتب شؤون موظفين.
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في الموارد البشرية (عن بعد): <a href=\"https://elearning.ksu.edu.sa/elearning/assets/uploads/files/DIPLOMA-HR.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في الموارد البشرية (عن بعد): <a href=\"https://elearning.ksu.edu.sa/elearning/assets/uploads/files/Course-Description-HR.pdf\">عرض الوصف</a>"
        },
        "دبلوم المصرفية الإسلامية": {
            "menu_text": "الرجاء اختيار: ",
            "options": [
                "تعريف بالتخصص",
                "الخطة الدراسية",
                "وصف المقررات",
                "🔙 رجوع"
            ],
            "تعريف بالتخصص": """🔹 <b>الدبلوم المتوسط في المصرفية الإسلامية – جامعة الملك سعود (عن بعد)</b>
<b>الرؤية العامة:</b>
يهدف البرنامج إلى إعداد متخصصين ومحترفين في المصرفية الإسلامية، قادرين على أداء المهام الإدارية والفنية بكفاءة في القطاعات المالية والمصرفية.
\n\n<b>🎯 الأهداف الرئيسة:</b>
• تزويد الطلاب بالمعارف النظرية والتطبيقية في العلوم المصرفية الإسلامية.
• تأهيل كوادر وطنية متخصصة للعمل في المؤسسات المالية الإسلامية.
• تطوير المهارات الفنية والإدارية للطلاب.
• تعزيز المهارات الرقمية والمهنية.
\n\n<b>💼 الفرص الوظيفية:</b>
• أمين صندوق، أمين مستودع، محصل إيرادات، مأمور صرف، مأمور مشتريات، مساعد مدرب (في مجال التخصص).
""",
            "الخطة الدراسية": "الخطة الدراسية للدبلوم المتوسط في المصرفية الإسلامية (عن بعد): <a href=\"https://elearning.ksu.edu.sa/elearning/assets/uploads/files/DIPLOMA-IBA.pdf\">عرض الخطة</a>",
            "وصف المقررات": "وصف المقررات الدراسية للدبلوم المتوسط في المصرفية الإسلامية (عن بعد): <a href=\"https://elearning.ksu.edu.sa/elearning/assets/uploads/files/Course-Description-IBA.pdf\">عرض الوصف</a>"
        }
    },
    "قروبات التخصص": """<b>● قروبات التخصص</b>
هذا الزر مخصص لقروبات الدبلوم في جامعة الملك سعود، وهو المصدر الأساسي لقروبات الدبلوم:
<a href="https://t.me/KDiplomasSU">قروبات الدبلوم 👨🏻‍💻</a>
<a href="https://t.me/ksu_diploma">قروبات الدبلوم 👩🏻‍💻</a>""",
    "قروبات المواد للمستجدين": """<b>● قروبات المواد للمستجدين</b>
نقدم لك هنا قروبات لمواد السنة الأولى للطلاب المستجدين،
للمساعدة على الفهم والدراسة لطلاب الدبلوم.

📚قروب أساسيات الرياضيات 2
<a href="https://t.me/math1104_24">https://t.me/math1104_24</a>

📚 قروب مهارات الحاسب
<a href="https://t.me/Cskills_101">https://t.me/Cskills_101</a>

📚 قروب مهارات التعلم
<a href="https://t.me/learning_skills_1445">https://t.me/learning_skills_1445</a>

📚 قروب اللغة الانجليزية
<a href="https://t.me/English101_KSU">https://t.me/English101_KSU</a>

📚 قروب المدخل للثقافة الإسلامية
<a href="https://t.me/KSU_Islam101">https://t.me/KSU_Islam101</a>

📚 قروب مهارات الاتصال
<a href="https://t.me/com101KSU">https://t.me/com101KSU</a>

📚 قروب الإدارة والتجارة الإلكترونية
<a href="https://t.me/EBusiness_101">https://t.me/EBusiness_101</a>

📚 قروب مقدمة في الإحصاء
<a href="https://t.me/KSU_stat101">https://t.me/KSU_stat101</a>

📚 قروب مبادئ الاقتصاد الجزئي
<a href="https://t.me/econ101_ksu_22">https://t.me/econ101_ksu_22</a>

📚 قروب مبادئ القانون
<a href="https://t.me/law101_ksu">https://t.me/law101_ksu</a>

📚 قروب مبادئ المحاسبة
<a href="https://t.me/ACC101_ksu">https://t.me/ACC101_ksu</a>""",
    "كتب وملخصات مواد الدبلوم": """<b>● كتب وملخصات مواد الدبلوم</b>
هنا ستجد الكتب والملخصات لجميع مواد دبلوم جامعة الملك سعود، مع إمكانية الوصول السهل والمباشر:
<a href="https://t.me/KSU_Diplomas_Books">كتب وملخصات الدبلوم 📚</a>""",
    "قناة وإعلانات الدبلوم 📢": """<b>● قناة وإعلانات الدبلوم</b>
هي القناة الرسمية الوحيدة لجميع إعلانات الدبلوم المشترك بجامعة الملك سعود.
<a href="https://t.me/KSDN_222">قناة الدبلوم 📢</a>""",
    "خدمات حل الواجبات وعمل المشاريع والبحوث": """خدمات حل الواجبات وعمل المشاريع والبحوث
هذه الخدمة تساعدك في إنجاز بحوثك وواجباتك، بأسعار تنافسية.
للتواصل:
<a href="https://t.me/KSDN_222">@KSDN_222</a>""",
    "مواقع فروع جامعة الملك سعود": """<b>● مواقع فروع جامعة الملك سعود</b>
الرجاء اختيار فرع الجامعة لعرض موقعه على خرائط قوقل:""",
    "شروط التجسير في جامعة الملك سعود": """<b>● شروط التجسير في جامعة الملك سعود</b>
تتيح جامعة الملك سعود لطلاب الدبلوم إكمال دراستهم في درجة البكالوريوس، وفي ما يلي روابط توضح الشروط والضوابط:
<a href="https://t.me/KSDN_222/165">شروط التجسير 📄</a>
<a href="https://t.me/KSDN_222/153">تجسير طلاب كلية المجتمع 🧑🏻‍🎓</a>
<a href="https://t.me/KSDN_222/152">تجسير طالبات كلية المجتمع 👩🏻‍🎓</a>""",
    "🛑شرح استخدام – البلاك بورد / Blackboard 🛑": """<b>● شرح استخدام – البلاك بورد / Blackboard 🛑</b>
شرح مفصل لطريقة استخدام البلاك بورد:
<a href="https://t.me/KSDN_222/502">شرح البلاك بورد 📚</a>""",
    "🔙 رجوع": "الرجوع للقائمة الرئيسية"
}

# --- وظيفة للتحقق من اشتراك المستخدم في قناة معينة ---
def is_subscribed(user_id, channel_id):
    """
    تتحقق مما إذا كان المستخدم مشتركًا في القناة المحددة.
    إذا كان المستخدم غير موجود أو حالة عضويته ليست 'عضو' أو 'مدير'، فإنها تعتبر غير مشترك.
    """
    try:
        member = bot.get_chat_member(channel_id, user_id)
        # حالات العضوية المقبولة: 'member' و 'creator' و 'administrator'
        return member.status in ['member', 'creator', 'administrator']
    except telebot.apihelper.ApiException as e:
        # إذا كانت القناة غير موجودة أو حدث خطأ آخر
        print(f"ERROR: Failed to check subscription for user {user_id} in channel {channel_id}: {e}")
        return False

# --- وظيفة لإنشاء لوحة المفاتيح الرئيسية ---
def get_main_keyboard():
    keyboard = types.ReplyKeyboardMarkup(row_width=2, resize_keyboard=True)
    for row in main_keyboard_layout:
        keyboard.row(*row)
    return keyboard

# --- وظيفة لإنشاء لوحة مفاتيح فرعية ---
def get_sub_keyboard(options):
    keyboard = types.ReplyKeyboardMarkup(row_width=1, resize_keyboard=True)
    for option in options:
        keyboard.add(option)
    return keyboard

# --- مُعالج أمر البدء (start) المحدث ---
@bot.message_handler(commands=['start', 'star'])
def start_command_handler(message):
    chat_id = message.chat.id
    user_id = message.from_user.id
    
    unsubscribed_channels = []
    for channel in REQUIRED_CHANNELS:
        if not is_subscribed(user_id, channel['id']):
            unsubscribed_channels.append(channel)

    if unsubscribed_channels:
        reply_message = "لاستخدام الروبوت يجب عليك أولاً الاشتراك في هذه الدردشات ⬇️"
        markup = types.InlineKeyboardMarkup()
        for channel in unsubscribed_channels:
            markup.add(types.InlineKeyboardButton("اشترك الان 👈", url=channel['url']))
        
        bot.send_message(chat_id, reply_message, reply_markup=markup)
        
    else:
        # إذا كان المستخدم مشتركاً في جميع القنوات، يتم إرسال الرسالة الترحيبية
        reply_message = (
            "🔹 **ما الذي يمكن لهذا البوت تقديمه؟**\n\n"
            "هذا البوت مُخصص لطلاب الدبلوم في جامعة الملك سعود، ويهدف إلى:\n\n"
            "✅ توفير المعلومات الدراسية بسهولة وسرعة\n"
            "✅ مساعدة الطالب في الوصول لكل ما يحتاجه من روابط ومصادر مهمة\n"
            "✅ تقليل الوقت والجهد المبذول في البحث\n"
            "✅ تجميع كل ما يهم الطالب في مكان واحد\n\n"
            "نأمل أن تكون هذه الخدمة عند حسن ظنكم،\n"
            "ونسعد دائمًا بخدمتكم 💙\n"
            "\"جزيل الشكر والتقدير لكم 🌹\"\n\n"
        )
        
        aoun_link = "https://t.me/Aoun_Academic"
        aoun_markup = types.InlineKeyboardMarkup()
        aoun_markup.add(types.InlineKeyboardButton("اضغط هنا للانضمام للقناة 👇", url=aoun_link))
        
        bot.send_message(chat_id, reply_message, parse_mode="Markdown", reply_markup=get_main_keyboard())
        bot.send_message(chat_id, "منصة عون الأكاديمية 👇", reply_markup=aoun_markup)

# --- معالج عام لرسائل المستخدم النصية ---
@bot.message_handler(content_types=['text'])
def handle_text_messages(message):
    chat_id = message.chat.id
    user_message = message.text

    # التحقق من اشتراك المستخدم قبل معالجة أي رسالة
    user_id = message.from_user.id
    is_fully_subscribed = all(is_subscribed(user_id, channel['id']) for channel in REQUIRED_CHANNELS)
    if not is_fully_subscribed and user_message not in ["start", "star"]:
        start_command_handler(message)
        return

    # معالجة أمر الرجوع
    if user_message == "🔙 رجوع":
        if chat_id in user_states:
            current_menu = user_states[chat_id]
            # إذا كان المستخدم في قائمة فرعية، يرجع إلى القائمة الرئيسية
            if current_menu in bot_content and isinstance(bot_content[current_menu], dict):
                user_states.pop(chat_id)
                bot.send_message(chat_id, "الرجوع للقائمة الرئيسية.", reply_markup=get_main_keyboard())
            else:
                # إذا كان في قائمة رئيسية أو في أي مكان آخر، يتم إعادة القائمة الرئيسية
                bot.send_message(chat_id, "الرجوع للقائمة الرئيسية.", reply_markup=get_main_keyboard())
        else:
            bot.send_message(chat_id, "الرجوع للقائمة الرئيسية.", reply_markup=get_main_keyboard())
        return

    # معالجة القائمة الفرعية
    if chat_id in user_states:
        current_menu_key = user_states[chat_id]
        if current_menu_key in bot_content and isinstance(bot_content[current_menu_key], dict):
            sub_menu = bot_content[current_menu_key]
            if user_message in sub_menu:
                content = sub_menu[user_message]
                if isinstance(content, dict):
                    # قائمة فرعية أخرى
                    user_states[chat_id] = user_message
                    bot.send_message(chat_id, content["menu_text"], reply_markup=get_sub_keyboard(content["options"]), parse_mode="HTML")
                else:
                    # محتوى نصي عادي
                    bot.send_message(chat_id, content, parse_mode="HTML", disable_web_page_preview=True)
            elif user_message == "🔙 رجوع":
                parent_menu_key = get_parent_menu(current_menu_key)
                if parent_menu_key:
                    user_states[chat_id] = parent_menu_key
                    parent_menu = bot_content[parent_menu_key]
                    bot.send_message(chat_id, parent_menu["menu_text"], reply_markup=get_sub_keyboard(parent_menu["options"]), parse_mode="HTML")
                else:
                    user_states.pop(chat_id)
                    bot.send_message(chat_id, "الرجوع للقائمة الرئيسية.", reply_markup=get_main_keyboard())
        return

    # معالجة القائمة الرئيسية
    if user_message in bot_content:
        content = bot_content[user_message]
        if isinstance(content, dict):
            # قائمة فرعية
            user_states[chat_id] = user_message
            bot.send_message(chat_id, content["menu_text"], reply_markup=get_sub_keyboard(content["options"]), parse_mode="HTML")
        else:
            # محتوى نصي عادي
            bot.send_message(chat_id, content, parse_mode="Markdown", disable_web_page_preview=True, reply_markup=get_main_keyboard())
    elif user_message == "🤖 اسأل الذكاء الاصطناعي":
        bot.send_message(chat_id, "أهلاً بك في خدمة الدردشة مع الذكاء الاصطناعي! يمكنك الآن طرح أي سؤال وسيتم الإجابة عليه. يمكنك أيضاً إرسال صورة مع سؤالك. للإيقاف، ارسل كلمة 'خروج'.", reply_markup=types.ReplyKeyboardRemove())
        bot.register_next_step_handler(message, handle_ai_chat)
    else:
        bot.send_message(chat_id, "عذراً، لم أفهم طلبك. يرجى اختيار أحد الأزرار من القائمة الرئيسية.", reply_markup=get_main_keyboard())

# --- معالج الدردشة مع الذكاء الاصطناعي ---
@bot.message_handler(func=lambda m: True)
def handle_ai_chat(message):
    chat_id = message.chat.id
    user_message = message.text

    if user_message and user_message.lower() == "خروج":
        bot.send_message(chat_id, "تم إيقاف خدمة الدردشة مع الذكاء الاصطناعي. يمكنك العودة للقائمة الرئيسية.", reply_markup=get_main_keyboard())
        return

    # رسالة للمستخدم أثناء المعالجة
    msg = bot.send_message(chat_id, "جاري التفكير...", reply_to_message_id=message.message_id)
    
    parts = []
    
    if message.caption:
        parts.append({"text": message.caption})
    elif user_message:
        parts.append({"text": user_message})

    if message.photo:
        # الحصول على أكبر صورة
        file_info = bot.get_file(message.photo[-1].file_id)
        downloaded_file = bot.download_file(file_info.file_path)
        
        # تحويل الصورة إلى Base64
        base64_image = base64.b64encode(downloaded_file).decode('utf-8')
        
        parts.append({
            "inlineData": {
                "mimeType": "image/jpeg",
                "data": base64_image
            }
        })

    if parts:
        try:
            ai_response = get_gemini_multimodal_response(parts)
            bot.edit_message_text(ai_response, chat_id, msg.message_id)
        except Exception as e:
            print(f"ERROR during AI response: {e}")
            bot.edit_message_text("عذراً، حدث خطأ أثناء معالجة طلبك.", chat_id, msg.message_id)
    else:
        bot.edit_message_text("الرجاء إرسال نص أو صورة مع سؤالك.", chat_id, msg.message_id)

    # الاستمرار في جلسة الدردشة
    bot.register_next_step_handler(message, handle_ai_chat)

def get_parent_menu(current_key):
    for key, value in bot_content.items():
        if isinstance(value, dict) and current_key in value:
            return key
    return None

# --- Webhook endpoint for Flask ---
@app.route('/' + TOKEN, methods=['POST'])
def getMessage():
    json_str = request.get_data().decode('UTF-8')
    update = telebot.types.Update.de_json(json_str)
    bot.process_new_updates([update])
    return "!", 200

@app.route('/')
def webhook():
    return "Bot is running", 200

if __name__ == '__main__':
    try:
        bot.remove_webhook()
        bot.set_webhook(url=RENDER_WEBHOOK_URL)
        print(f"✅ تم تعيين الـ Webhook بنجاح على: {RENDER_WEBHOOK_URL}")
    except Exception as e:
        print(f"❌ فشل في تعيين الـ Webhook: {e}")
    app.run(host="0.0.0.0", port=int(os.environ.get('PORT', 5000)))
